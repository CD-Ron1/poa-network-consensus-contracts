<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:63,&quot;tests&quot;:189,&quot;passes&quot;:189,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2018-05-03T11:00:14.903Z&quot;,&quot;end&quot;:&quot;2018-05-03T11:03:00.789Z&quot;,&quot;duration&quot;:165886,&quot;testsRegistered&quot;:189,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false,&quot;passPercentClass&quot;:&quot;success&quot;,&quot;pendingPercentClass&quot;:&quot;danger&quot;},&quot;suites&quot;:{&quot;uuid&quot;:&quot;b4bd6060-8bfb-4356-9424-dd9b2406ec0b&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3201e4f7-be82-49b6-a48b-8ae0162b36eb&quot;,&quot;title&quot;:&quot;ValidatorMetadataNew&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataNew \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;181e7db6-8c50-4729-b5bd-2b1e0c627133&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataNew \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f2138b28-bd94-4609-a8b9-b53346482d13&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataNew \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0c41bd9-1abc-4524-b74c-cee50d954f7a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c4d4cc55-6706-4309-9bb5-18404aed62c9&quot;,&quot;title&quot;:&quot;BallotsStorageMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;BallotsStorageMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0dce1129-65f1-4335-a0b1-be8a040a3441&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;BallotsStorageMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;529010b7-6678-40a7-a017-8f7c3a2b2107&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;BallotsStorageMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5165048b-7898-481e-a987-47a5cd134bfa&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6a4f2515-d298-42ab-812a-00c366230911&quot;,&quot;title&quot;:&quot;EternalStorageProxyMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;EternalStorageProxyMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;94bfeaed-fc08-4a35-b35e-01b5894455dc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;EternalStorageProxyMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7457b578-0153-46cf-8129-1f4dce3731ad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;EternalStorageProxyMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c09b614b-f2a1-4cb0-b71e-d1c5c00a08b8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3c0ce62d-c21a-42f6-87f1-af7115973a8e&quot;,&quot;title&quot;:&quot;KeysManagerMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;KeysManagerMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5fd00fb5-5a27-4d93-95df-11e021bfe7ee&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;KeysManagerMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2810c4a8-f987-48b7-ba77-da45fc704d98&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;KeysManagerMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aa6c8aec-420b-4c79-9907-b4712cba8568&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;df67e35f-945c-45a4-a0f9-9445b9a46662&quot;,&quot;title&quot;:&quot;PoaNetworkConsensusMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;PoaNetworkConsensusMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;694e4ab7-d8de-4d02-a1bd-9d09de8b9d22&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;PoaNetworkConsensusMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d2c63f2-7868-4189-8851-b4aa163482e4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;PoaNetworkConsensusMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;206a13a6-6a9b-4246-ac9f-7fa889d3ddce&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;95dfb7db-1002-4d23-a545-34c18a350cd4&quot;,&quot;title&quot;:&quot;ProxyStorageMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;ProxyStorageMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;761a2085-e881-434c-8aa9-cb572eef7854&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;ProxyStorageMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0e50b8f8-22dc-4be3-89af-48403f5012ac&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;ProxyStorageMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;094f0161-590f-4e00-a239-2e5ac5063712&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;46ae022b-cd9d-4989-8296-43771271fc1a&quot;,&quot;title&quot;:&quot;ValidatorMetadataMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1cfdae6f-7bec-48d0-bcfc-84273c8e4266&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ce1d57d-56e0-4167-9b45-a92cb54b1e2b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75837ae3-e2b0-4cef-bd58-8743755f739e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;139e6c7b-b145-4ec7-9a2e-ed648c776ead&quot;,&quot;title&quot;:&quot;VotingToChangeKeysMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeKeysMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4085bafa-3753-4d5e-93c6-a5a9983373d3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeKeysMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a950ec2-6a8b-44f8-b33f-cb2081e2728d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeKeysMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6095ef9-46c6-414f-881b-d36f1a57f3b7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a6c2207b-693f-4133-9d1d-4653590a7770&quot;,&quot;title&quot;:&quot;VotingToChangeMinThresholdMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMinThresholdMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f055cb6b-b064-4121-81fa-0c98b70549de&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMinThresholdMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4cf27e1-a36d-40ba-9c33-2ddbe24a7bd7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMinThresholdMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ff2cc683-760b-4c7b-b256-d8c9968ab574&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ed6e53b5-f866-45e5-8ccc-f42948ede2b1&quot;,&quot;title&quot;:&quot;VotingToChangeProxyAddressMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeProxyAddressMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8deaac34-4339-499f-a315-347e82431727&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeProxyAddressMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25f415c1-aebd-48b5-822f-542287a13ec1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeProxyAddressMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d856365e-6d06-490b-9519-5578f0c493e9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;311d7ece-0b98-4234-8e21-8640ea4ea20c&quot;,&quot;title&quot;:&quot;Contract: BallotsStorage [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bfd574f2-8e52-4949-b3a4-7af72bb6c35e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c602f53-10cb-4f73-9300-9210f2b86395&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:280,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\nproxyStorage = await ProxyStorageMock.new(poaNetworkConsensus.address);\nballotsStorageMock = await BallotsStorageMock.new(proxyStorage.address);\nkeysManager = await KeysManagerMock.new(proxyStorage.address, poaNetworkConsensus.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\nawait poaNetworkConsensus.setProxyStorage(proxyStorage.address);\nawait proxyStorage.initializeAddresses(\n  keysManager.address,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  ballotsStorageMock.address,\n  validatorMetadataEternalStorage\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d7ba7ba-1349-4906-82c2-f7e90a87201d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d70de099-b864-4895-9a21-70c1759f2b5b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7cd1d71e-6559-4981-ae33-b2fa89f32503&quot;,&quot;title&quot;:&quot;#constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets MoC and Poa&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #constructor sets MoC and Poa&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(3).should.be.bignumber.equal(\n  await ballotsStorageMock.getBallotThreshold(1)\n);\nnew web3.BigNumber(2).should.be.bignumber.equal(\n  await ballotsStorageMock.getBallotThreshold(2)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57c0f463-d5a5-48f0-a951-2b8747ed91ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;57c0f463-d5a5-48f0-a951-2b8747ed91ca&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ecda13e1-cb89-49a5-8036-10b898fad651&quot;,&quot;title&quot;:&quot;#setThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can only be called from votingToChangeThreshold address&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold can only be called from votingToChangeThreshold address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorageMock.setThreshold(4, 1, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageMock.setThreshold(4, 1, {from: accounts[3]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0a5adb65-3b75-47d0-8cd1-849247f20343&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be set for Invalid threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold cannot be set for Invalid threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:121,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorageMock.setThreshold(5, 0, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageMock.setThreshold(5, -10, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageMock.setThreshold(5, -1, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageMock.setThreshold(5, 3, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86a23925-49a6-414c-8a35-70c5e29bcdca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new value cannot be equal to 0&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold new value cannot be equal to 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:133,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorageMock.setThreshold(0, 1, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageMock.setThreshold(0, 2, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageMock.setThreshold(4, 1, {from: accounts[3]}).should.be.fulfilled;\nawait ballotsStorageMock.setThreshold(4, 2, {from: accounts[3]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9ce54203-2a60-411e-97c4-b4c6784c76eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets new value for Keys threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold sets new value for Keys threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorageMock.setThreshold(5, 1, {from: accounts[3]}).should.be.fulfilled; \nnew web3.BigNumber(5).should.be.bignumber.equal(await ballotsStorageMock.getBallotThreshold(1));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3dfb433e-09c2-4921-928e-6a9772b692af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets new value for MetadataChange threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold sets new value for MetadataChange threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorageMock.setThreshold(6, 2, {from: accounts[3]}).should.be.fulfilled;\nnew web3.BigNumber(6).should.be.bignumber.equal(await ballotsStorageMock.getBallotThreshold(2));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2575c64b-a13a-48a1-940b-f3baff53968b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0a5adb65-3b75-47d0-8cd1-849247f20343&quot;,&quot;86a23925-49a6-414c-8a35-70c5e29bcdca&quot;,&quot;9ce54203-2a60-411e-97c4-b4c6784c76eb&quot;,&quot;3dfb433e-09c2-4921-928e-6a9772b692af&quot;,&quot;2575c64b-a13a-48a1-940b-f3baff53968b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:439,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;3b8e01c4-29be-4b8a-bd76-47cd568f5ce2&quot;,&quot;title&quot;:&quot;#getTotalNumberOfValidators&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns total number of validators&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getTotalNumberOfValidators returns total number of validators&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:175,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setKeysManagerMock(masterOfCeremony);\nawait poaNetworkConsensus.addValidator(accounts[1], true);\nawait poaNetworkConsensus.setSystemAddress(masterOfCeremony);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nconst getValidators = await poaNetworkConsensus.getValidators();\nnew web3.BigNumber(2).should.be.bignumber.equal(getValidators.length);\nnew web3.BigNumber(2).should.be.bignumber.equal(await ballotsStorageMock.getTotalNumberOfValidators())&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8189f96c-610f-4240-9578-a36305964630&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8189f96c-610f-4240-9578-a36305964630&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:175,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;1c59ed91-02c0-49f8-b4f9-60224139fffd&quot;,&quot;title&quot;:&quot;#getProxyThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns total number of validators&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getProxyThreshold returns total number of validators&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:433,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(1).should.be.bignumber.equal(await ballotsStorageMock.getProxyThreshold())\nawait proxyStorage.setKeysManagerMock(masterOfCeremony);\nawait poaNetworkConsensus.addValidator(accounts[1], true);\nawait poaNetworkConsensus.addValidator(accounts[2], true);\nawait poaNetworkConsensus.addValidator(accounts[3], true);\nawait poaNetworkConsensus.addValidator(accounts[4], true);\nawait poaNetworkConsensus.addValidator(accounts[5], true);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nconst getValidators = await poaNetworkConsensus.getValidators();\nnew web3.BigNumber(6).should.be.bignumber.equal(getValidators.length);\nnew web3.BigNumber(3).should.be.bignumber.equal(await ballotsStorageMock.getProxyThreshold())&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;61e8974c-0708-476f-a85d-23fcee0d60bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;61e8974c-0708-476f-a85d-23fcee0d60bb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:433,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;91c3a7b5-1992-4690-be56-68c905b93235&quot;,&quot;title&quot;:&quot;#getVotingToChangeThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns voting to change min threshold address&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getVotingToChangeThreshold returns voting to change min threshold address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingToChangeMinThreshold.should.be.equal(await ballotsStorageMock.getVotingToChangeThreshold())\nawait proxyStorage.setVotingToChangeMinThresholdMock(accounts[4]);\naccounts[4].should.be.equal(await ballotsStorageMock.getVotingToChangeThreshold())&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e6cd4412-0c9a-44f0-9292-da1e4e7092dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e6cd4412-0c9a-44f0-9292-da1e4e7092dd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:58,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;2048b57d-21e1-4b6e-9f32-9123030b3c0c&quot;,&quot;title&quot;:&quot;#getBallotLimit&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns limit per validator to create ballots&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getBallotLimit returns limit per validator to create ballots&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:270,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let limit = await ballotsStorageMock.getBallotLimitPerValidator();\nlimit.should.be.bignumber.equal(200);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlimit = await ballotsStorageMock.getBallotLimitPerValidator();\nlimit.should.be.bignumber.equal(100);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea66d8e0-02b8-48dc-81f2-393ca3accb10&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ea66d8e0-02b8-48dc-81f2-393ca3accb10&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:270,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;c076840b-dc4d-4941-8f2f-e4d5ee29f9d1&quot;,&quot;title&quot;:&quot;Contract: KeysManager [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:334,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62021113-2e23-4a1e-b06a-2bef4214ad29&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;56e39f2b-0e29-44f6-943d-bd312887d099&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:245,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\nproxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensusMock.address);\nkeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  masterOfCeremony,\n  masterOfCeremony,\n  masterOfCeremony,\n  masterOfCeremony,\n  masterOfCeremony\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f6a5ff8-e2cc-47a6-95ea-757d59bc0b07&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a025d39f-1fae-4b13-aa69-f1be972ee51a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3e56a98f-f39c-40f3-a318-bc36dd0535c5&quot;,&quot;title&quot;:&quot;#constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets masterOfCeremony, proxyStorage, poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #constructor sets masterOfCeremony, proxyStorage, poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;masterOfCeremony.should.be.equal(await keysManager.masterOfCeremony());\nproxyStorageMock.address.should.be.equal(await keysManager.proxyStorage());\npoaNetworkConsensusMock.address.should.be.equal(await keysManager.poaNetworkConsensus());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dab72686-761b-4468-9282-a7f08dfb3d9c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;adds masterOfCeremony to validators hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #constructor adds masterOfCeremony to validators hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validator = await keysManager.validatorKeys(masterOfCeremony);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8bf750d4-0b75-48c8-8e29-32acf869ff1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dab72686-761b-4468-9282-a7f08dfb3d9c&quot;,&quot;8bf750d4-0b75-48c8-8e29-32acf869ff1d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;02aabf40-5c10-431a-8031-caa04e8c921c&quot;,&quot;title&quot;:&quot;#initiateKeys&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can only be called by master of ceremony&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys can only be called by master of ceremony&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec1c8a74-80de-4e2f-ae1a-88c4a5dd84bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot allow 0x0 addresses&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys cannot allow 0x0 addresses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000000&#x27;).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.initiateKeys(&#x27;0x0&#x27;).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e21e668e-c504-4111-a71d-67cca76ec9c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize already initialized key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not allow to initialize already initialized key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;   \nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;47b910b0-409b-47be-8090-42ed9db2d75e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize already initialized key after validator created mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not allow to initialize already initialized key after validator created mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:118,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;   \nawait keysManager.createKeys(accounts[3],accounts[4],accounts[5], {from: accounts[2]}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e3cd0c54-8cc2-45a5-a04e-b2a10cb66e36&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not equal to master of ceremony&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not equal to master of ceremony&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(masterOfCeremony, {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1736488c-5fdb-4eb4-8ae9-73dbf8ac1db0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize more than maxNumberOfInitialKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not allow to initialize more than maxNumberOfInitialKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:141,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.setMaxNumberOfInitialKeys(2);\nlet maxNumberOfInitialKeys = await keysManager.maxNumberOfInitialKeys();\nmaxNumberOfInitialKeys.should.be.bignumber.equal(2);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[3], {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7189ae9-9857-482f-8e8d-6d09332f19b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize more than maxNumberOfInitialKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not allow to initialize more than maxNumberOfInitialKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:478,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let maxNumberOfInitialKeys = await keysManager.maxNumberOfInitialKeys();\nmaxNumberOfInitialKeys.should.be.bignumber.equal(12);\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000001&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000002&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000003&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000004&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000005&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000006&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000007&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000008&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000009&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000010&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000011&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000012&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000013&#x27;, {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5bd88fda-4ea5-4f18-a71a-046b2b1baeec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment initialKeyCount by 1&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should increment initialKeyCount by 1&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let initialKeysCount = await keysManager.initialKeysCount();\ninitialKeysCount.should.be.bignumber.equal(0);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\ninitialKeysCount = await keysManager.initialKeysCount();\ninitialKeysCount.should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37072427-766e-4073-bfdb-defb2f20df99&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set initialKeys hash to activated status&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should set initialKeys hash to activated status&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(0).should.be.bignumber.equal(await keysManager.initialKeys(accounts[1]));\nconst {logs} = await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nnew web3.BigNumber(1).should.be.bignumber.equal(await keysManager.initialKeys(accounts[1]));\nlet initialKeysCount = await keysManager.initialKeysCount();\n// event InitialKeyCreated(address indexed initialKey, uint256 time, uint256 initialKeysCount);\nlogs[0].event.should.equal(\&quot;InitialKeyCreated\&quot;);\nlogs[0].args.initialKey.should.be.equal(accounts[1]);\ninitialKeysCount.should.be.bignumber.equal(logs[0].args.initialKeysCount);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0cb5665e-64ac-40df-baf6-48ea7380d469&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ec1c8a74-80de-4e2f-ae1a-88c4a5dd84bc&quot;,&quot;e21e668e-c504-4111-a71d-67cca76ec9c4&quot;,&quot;47b910b0-409b-47be-8090-42ed9db2d75e&quot;,&quot;e3cd0c54-8cc2-45a5-a04e-b2a10cb66e36&quot;,&quot;1736488c-5fdb-4eb4-8ae9-73dbf8ac1db0&quot;,&quot;e7189ae9-9857-482f-8e8d-6d09332f19b9&quot;,&quot;5bd88fda-4ea5-4f18-a71a-046b2b1baeec&quot;,&quot;37072427-766e-4073-bfdb-defb2f20df99&quot;,&quot;0cb5665e-64ac-40df-baf6-48ea7380d469&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1059,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;f9414ba4-8341-40d7-9528-3808f1ed7e79&quot;,&quot;title&quot;:&quot;#createKeys&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should only be called from initialized key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should only be called from initialized key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:119,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.createKeys(accounts[2], accounts[3], accounts[4], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[2], accounts[3], accounts[4], {from: accounts[1]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f28509ad-62a6-4cb1-85cd-97d7d8bb101b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;params should not be equal to each other&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys params should not be equal to each other&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:107,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(masterOfCeremony, masterOfCeremony, accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[2], accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[2], masterOfCeremony, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b75d4564-91bb-433c-acdc-40b54e72f61e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;any of params should not be equal to initialKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys any of params should not be equal to initialKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[1], masterOfCeremony, accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[1], accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[2], accounts[1], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a8791408-8f75-4728-ba2d-5a33638dbfcb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign mining, voting, payout keys to relative mappings&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should assign mining, voting, payout keys to relative mappings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:155,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nconst {logs} = await keysManager.createKeys(accounts[4], accounts[3], accounts[2], {from: accounts[1]}).should.be.fulfilled;\ntrue.should.be.equal(\n  await keysManager.isMiningActive(accounts[4])\n)\ntrue.should.be.equal(\n  await keysManager.isVotingActive(accounts[3])\n)\ntrue.should.be.equal(\n  await keysManager.isPayoutActive(accounts[4])\n)\n// event ValidatorInitialized(address indexed miningKey, address indexed votingKey, address indexed payoutKey);\nlogs[0].event.should.be.equal(&#x27;ValidatorInitialized&#x27;);\nlogs[0].args.miningKey.should.be.equal(accounts[4]);\nlogs[0].args.votingKey.should.be.equal(accounts[3]);\nlogs[0].args.payoutKey.should.be.equal(accounts[2]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d3082d9-0b22-4b75-ab0e-984e465900d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assigns voting &lt;-&gt; mining key relationship&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should assigns voting &lt;-&gt; mining key relationship&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:142,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[4], accounts[3], accounts[2], {from: accounts[1]});\nconst miningKey = await keysManager.getMiningKeyByVoting(accounts[3]);\nminingKey.should.be.equal(accounts[4]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88c01d05-b2e1-4b9f-a547-363bc6d36405&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;adds validator to poaConsensus contract&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys adds validator to poaConsensus contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:117,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[4];\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, accounts[3], accounts[2], {from: accounts[1]});\nconst index = await poaNetworkConsensusMock.currentValidatorsLength();\n(await poaNetworkConsensusMock.pendingList(index)).should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c569897d-babf-49d5-a167-b405190b601d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorKeys hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should set validatorKeys hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:106,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[4];\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, accounts[3], accounts[2], {from: accounts[1]});\nconst validatorKey = await keysManager.validatorKeys(miningKey);\nvalidatorKey.should.be.deep.equal([\n  accounts[3],\n  accounts[2],\n  true,\n  true,\n  true\n])&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf03e0b5-d17e-4b22-b8b8-e94eb40e9b6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorKeys hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should set validatorKeys hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:151,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[4];\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, accounts[3], accounts[2], {from: accounts[1]});\nnew web3.BigNumber(2).should.be.bignumber.equal(await keysManager.initialKeys(accounts[1]));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9285db67-4521-464d-8c9c-674a681bd942&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f28509ad-62a6-4cb1-85cd-97d7d8bb101b&quot;,&quot;b75d4564-91bb-433c-acdc-40b54e72f61e&quot;,&quot;a8791408-8f75-4728-ba2d-5a33638dbfcb&quot;,&quot;5d3082d9-0b22-4b75-ab0e-984e465900d5&quot;,&quot;88c01d05-b2e1-4b9f-a547-363bc6d36405&quot;,&quot;c569897d-babf-49d5-a167-b405190b601d&quot;,&quot;cf03e0b5-d17e-4b22-b8b8-e94eb40e9b6c&quot;,&quot;9285db67-4521-464d-8c9c-674a681bd942&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:994,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;f5c613e2-015c-4bd4-9200-58fa5c9ff906&quot;,&quot;title&quot;:&quot;#addMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should only be called from votingToChangeKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addMiningKey should only be called from votingToChangeKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:107,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1],{from: accounts[5]}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorageMock.setVotingContractMock(accounts[2]);\nawait keysManager.addMiningKey(accounts[1], {from: accounts[2]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aac39ab2-f6fd-419d-856c-af7e8fe5e366&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let add more than maxLimit&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addMiningKey should not let add more than maxLimit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensusMock.setCurrentValidatorsLength(2001);\nawait keysManager.addMiningKey(accounts[2]).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;042b531e-c7c5-4707-86ef-662129790328&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorKeys hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addMiningKey should set validatorKeys hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[2]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false]\n)\nlogs[0].event.should.be.equal(&#x27;MiningKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.action.should.be.equal(&#x27;added&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1183209-3224-4849-a276-5d12ff770a5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;aac39ab2-f6fd-419d-856c-af7e8fe5e366&quot;,&quot;042b531e-c7c5-4707-86ef-662129790328&quot;,&quot;c1183209-3224-4849-a276-5d12ff770a5e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:231,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ef8be1c9-14cd-49d5-ba37-e75abd6b60de&quot;,&quot;title&quot;:&quot;#addVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should add VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addVotingKey should add VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:178,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addVotingKey(accounts[2],accounts[1], {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nconst {logs} = await keysManager.addVotingKey(accounts[2], accounts[1]).should.be.fulfilled;\ntrue.should.be.equal(await keysManager.isVotingActive(accounts[2]));\nlogs[0].event.should.be.equal(&#x27;VotingKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.miningKey.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;added&#x27;);\nconst miningKey = await keysManager.getMiningKeyByVoting(accounts[2]);\nminingKey.should.be.equal(accounts[1]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;31bc5a44-0d6a-4d55-87d8-f4b66f8d4a00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be called if mining is active&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addVotingKey should only be called if mining is active&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:143,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[2], accounts[1]).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36f3d859-63be-4191-9f22-4f29f1f46d04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;swaps keys if voting already exists&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addVotingKey swaps keys if voting already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:187,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[2], accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[3], accounts[1]).should.be.fulfilled;\nfalse.should.be.equal(await keysManager.isVotingActive(accounts[2]));\ntrue.should.be.equal(await keysManager.isVotingActive(accounts[3]));\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f1e939ec-39f6-4523-836f-6d30834acfc4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;31bc5a44-0d6a-4d55-87d8-f4b66f8d4a00&quot;,&quot;36f3d859-63be-4191-9f22-4f29f1f46d04&quot;,&quot;f1e939ec-39f6-4523-836f-6d30834acfc4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:508,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;eb612501-afd6-4621-9aeb-255695f2acb3&quot;,&quot;title&quot;:&quot;#addPayoutKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should add PayoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addPayoutKey should add PayoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:152,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addPayoutKey(accounts[2],accounts[1]).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nconst {logs} = await keysManager.addPayoutKey(accounts[2], accounts[1]).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;PayoutKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.miningKey.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;added&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;317f50d8-1865-40b8-8119-7decc84e7be7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be called if mining is active&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addPayoutKey should only be called if mining is active&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:161,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addPayoutKey(accounts[2], accounts[1]).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9cc95b5d-5458-46a9-ba0d-119d9ccd7926&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;swaps keys if voting already exists&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addPayoutKey swaps keys if voting already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addPayoutKey(accounts[2], accounts[1]).should.be.fulfilled;\nawait keysManager.addPayoutKey(accounts[3], accounts[1]).should.be.fulfilled;\ntrue.should.be.equal(await keysManager.isPayoutActive(accounts[1]));\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[3],\n  true,\n  false,\n  true]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0f7e35f-9650-40da-8e38-58bf49f936a5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;317f50d8-1865-40b8-8119-7decc84e7be7&quot;,&quot;9cc95b5d-5458-46a9-ba0d-119d9ccd7926&quot;,&quot;f0f7e35f-9650-40da-8e38-58bf49f936a5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:477,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;26b8939f-bd8c-4cca-b173-9445023dafa6&quot;,&quot;title&quot;:&quot;#removeMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should remove miningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeMiningKey should remove miningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:260,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.removeMiningKey(accounts[1], {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[3], accounts[1]).should.be.fulfilled;\nconst {logs} = await keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nlogs[0].event.should.be.equal(&#x27;MiningKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);\nconst miningKey = await keysManager.getMiningKeyByVoting(validator[0]);\nminingKey.should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed92458a-ec80-4c77-9f5f-b110d47b55f6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;removes validator from poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeMiningKey removes validator from poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:285,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensusMock.currentValidatorsLength();\nlet pendingList = [];\nfor(let i = 0; i &lt; currentValidatorsLength.sub(1).toNumber(); i++){\n    let pending = await poaNetworkConsensusMock.pendingList(i);\n    pendingList.push(pending);\n}\npendingList.should.not.contain(accounts[1]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators();\nvalidators.should.not.contain(accounts[1]);\nconst expected = currentValidatorsLength.sub(1);\nconst actual = await poaNetworkConsensusMock.currentValidatorsLength();\nexpected.should.be.bignumber.equal(actual);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e58572a9-951c-4d35-bfd9-0c5d26a44d7e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should still enforce removal of votingKey to 0x0 even if voting key didnot exist&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeMiningKey should still enforce removal of votingKey to 0x0 even if voting key didnot exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:201,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.removeMiningKey(accounts[1]).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nconst {logs} = await keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[1]);\nconst miningKey = await keysManager.getMiningKeyByVoting(validator[0]);\nminingKey.should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;67dbad7a-78fc-4818-b76a-a8ba63c8d327&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ed92458a-ec80-4c77-9f5f-b110d47b55f6&quot;,&quot;e58572a9-951c-4d35-bfd9-0c5d26a44d7e&quot;,&quot;67dbad7a-78fc-4818-b76a-a8ba63c8d327&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:746,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5750d337-0f39-49cb-8c83-0815f05927e9&quot;,&quot;title&quot;:&quot;#removeVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should remove votingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeVotingKey should remove votingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:238,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {mining, voting, payout} = {mining: accounts[1], voting: accounts[3], payout: accounts[2]};\nawait keysManager.removeVotingKey(mining, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(mining).should.be.fulfilled;\nawait keysManager.addVotingKey(voting, mining).should.be.fulfilled;\nawait keysManager.addPayoutKey(payout, mining).should.be.fulfilled;\nconst {logs} = await keysManager.removeVotingKey(mining).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(mining);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  payout,\n  true,\n  false,\n  true]\n)\nlogs[0].event.should.be.equal(&#x27;VotingKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(voting);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);\nconst miningKey = await keysManager.getMiningKeyByVoting(accounts[1]);\nminingKey.should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;785644df-841a-4045-83db-3b89026b62e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;785644df-841a-4045-83db-3b89026b62e6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:238,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5affd0d0-112a-40e0-9088-0201a0d23c94&quot;,&quot;title&quot;:&quot;#removePayoutKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should remove payoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removePayoutKey should remove payoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:191,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.removePayoutKey(accounts[1], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addPayoutKey(accounts[2], accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[3], accounts[1]).should.be.fulfilled;\nconst {logs} = await keysManager.removePayoutKey(accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false]\n)\nlogs[0].event.should.be.equal(&#x27;PayoutKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;930ad971-5ef0-40f2-aa0b-67d82b59d6a5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;930ad971-5ef0-40f2-aa0b-67d82b59d6a5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:191,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;8c0f1462-9034-4336-8992-5f253a583495&quot;,&quot;title&quot;:&quot;#swapMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapMiningKey should swap mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:242,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.swapMiningKey(accounts[1], accounts[2], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.swapMiningKey(accounts[2], accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nconst validatorNew = await keysManager.validatorKeys(accounts[2]);\nvalidatorNew.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bce993ad-2cbb-430d-9241-ffe3eb69a756&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should keep voting and payout keys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapMiningKey should keep voting and payout keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:363,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const oldMining = accounts[1];\nconst voting = accounts[2];\nconst payout = accounts[3];\nconst newMining = accounts[4];\nawait keysManager.addMiningKey(oldMining).should.be.fulfilled;\nawait keysManager.addVotingKey(voting, oldMining).should.be.fulfilled;\nawait keysManager.addPayoutKey(payout, oldMining).should.be.fulfilled;\nconst {logs} = await keysManager.swapMiningKey(newMining, oldMining).should.be.fulfilled;\nconst mining = await keysManager.getMiningKeyByVoting(voting);\nconst validator = await keysManager.validatorKeys(oldMining);\nconst miningCheck = await keysManager.getMiningKeyByVoting(voting);\nminingCheck.should.be.equal(newMining);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nconst validatorNew = await keysManager.validatorKeys(newMining);\nvalidatorNew.should.be.deep.equal(\n  [ voting,\n  payout,\n  true,\n  true,\n  true]\n)\noldMining.should.be.equal(await keysManager.getMiningKeyHistory(newMining));\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators();\nvalidators.should.not.contain(oldMining);\nvalidators.should.contain(newMining);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dbdb0285-88bf-4dad-abb3-85a84769b14e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bce993ad-2cbb-430d-9241-ffe3eb69a756&quot;,&quot;dbdb0285-88bf-4dad-abb3-85a84769b14e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:605,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5c7d6bb5-f1a4-4409-a84c-d6f42b20cbd4&quot;,&quot;title&quot;:&quot;#swapVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapVotingKey should swap voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:187,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.swapVotingKey(accounts[1], accounts[2], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[2], accounts[1]).should.be.fulfilled;\nawait keysManager.swapVotingKey(accounts[3], accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9c9c380-71b8-46f1-9f21-c59751026115&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b9c9c380-71b8-46f1-9f21-c59751026115&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:187,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;a299c82a-4851-46ff-9951-c31bf1356870&quot;,&quot;title&quot;:&quot;#swapPayoutKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap payout key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapPayoutKey should swap payout key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:216,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.swapPayoutKey(accounts[1], accounts[2], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addPayoutKey(accounts[2], accounts[1]).should.be.fulfilled;\nawait keysManager.swapPayoutKey(accounts[3], accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[3],\n  true,\n  false,\n  true]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6a2054a-a2be-4112-a095-6ac8ee0778f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d6a2054a-a2be-4112-a095-6ac8ee0778f8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:216,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;169e0357-8b60-4d70-b791-097872ab1861&quot;,&quot;title&quot;:&quot;#migrateInitialKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can copy initial keys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #migrateInitialKey can copy initial keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:207,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1]);\nlet newKeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, keysManager.address);\nkeysManager.address.should.be.equal(\n  await newKeysManager.previousKeysManager()\n)\nlet initialKeys = await newKeysManager.initialKeysCount();\ninitialKeys.should.be.bignumber.equal(1);\nlet {logs} = await newKeysManager.migrateInitialKey(accounts[1]);\nlogs[0].event.should.equal(\&quot;Migrated\&quot;);\nlogs[0].args.key.should.be.equal(accounts[1]);\nlogs[0].args.name.should.be.equal(\&quot;initialKey\&quot;);\nnew web3.BigNumber(1).should.be.bignumber.equal(\n  await newKeysManager.initialKeys(accounts[1])\n)\nawait newKeysManager.migrateInitialKey(accounts[2]).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(0).should.be.bignumber.equal(\n  await newKeysManager.initialKeys(accounts[2])\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e3e9b6e-8c69-4b91-970b-e832fbfffdc9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;copies validator keys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #migrateInitialKey copies validator keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:543,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// let masterOfCeremony = accounts[0];\nlet miningKey = accounts[2];\nlet votingKey = accounts[3];\nlet payoutKey = accounts[4];\nlet mining2 = accounts[5];\nawait proxyStorageMock.setVotingContractMock(accounts[2]);\nawait keysManager.addMiningKey(mining2, {from: accounts[2]}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, votingKey, payoutKey, {from: accounts[1]}).should.be.fulfilled;\nconst validatorKeyFromOld = await keysManager.validatorKeys(miningKey);\nvalidatorKeyFromOld.should.be.deep.equal([\n  votingKey,\n  payoutKey,\n  true,\n  true,\n  true\n])\nlet newKeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, keysManager.address);\n// mining #1\nlet {logs} = await newKeysManager.migrateMiningKey(miningKey);\nlogs[0].event.should.equal(\&quot;Migrated\&quot;);\nlogs[0].args.key.should.be.equal(miningKey);\nlogs[0].args.name.should.be.equal(\&quot;miningKey\&quot;);\nlet initialKeys = await newKeysManager.initialKeysCount();\ninitialKeys.should.be.bignumber.equal(1);\nconst validatorKey = await newKeysManager.validatorKeys(miningKey);\nvalidatorKey.should.be.deep.equal([\n  votingKey,\n  payoutKey,\n  true,\n  true,\n  true\n])\ntrue.should.be.equal(\n  await newKeysManager.successfulValidatorClone(miningKey)\n)\nminingKey.should.be.equal(\n  await newKeysManager.getMiningKeyByVoting(votingKey)\n);\ntrue.should.be.equal(\n  await newKeysManager.isMiningActive(miningKey)\n)\ntrue.should.be.equal(\n  await newKeysManager.isVotingActive(votingKey)\n)\ntrue.should.be.equal(\n  await newKeysManager.isPayoutActive(miningKey)\n)\n// mining#2\nawait newKeysManager.migrateMiningKey(mining2);\nconst validatorKey2 = await newKeysManager.validatorKeys(mining2);\nvalidatorKey2.should.be.deep.equal([\n  \&quot;0x0000000000000000000000000000000000000000\&quot;,\n  \&quot;0x0000000000000000000000000000000000000000\&quot;,\n  true,\n  false,\n  false\n])\ntrue.should.be.equal(\n  await newKeysManager.isMiningActive(mining2)\n)\ntrue.should.be.equal(\n  await newKeysManager.successfulValidatorClone(mining2)\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c5077cb-b485-4228-aeb5-195d8f9a7e30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;throws when trying to copy invalid mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #migrateInitialKey throws when trying to copy invalid mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:115,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newKeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, keysManager.address);\ntrue.should.be.equal(\n  await newKeysManager.successfulValidatorClone(masterOfCeremony)\n);\nawait newKeysManager.migrateMiningKey(masterOfCeremony).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7acdd547-4378-47a3-bb8b-30278b411811&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3e3e9b6e-8c69-4b91-970b-e832fbfffdc9&quot;,&quot;6c5077cb-b485-4228-aeb5-195d8f9a7e30&quot;,&quot;7acdd547-4378-47a3-bb8b-30278b411811&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:865,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5aa9e560-f1a3-4283-85ea-1bad578df0e4&quot;,&quot;title&quot;:&quot;Contract: ValidatorMetadata [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1023,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10a1cce7-2c74-40cb-a32d-7a729eeccdc2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dba9ba7f-4930-470c-9865-4535edc30739&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:703,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n   proxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensusMock.address);\n   keysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\n   ballotsStorage = await BallotsStorage.new(proxyStorageMock.address);\n   await poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\n   metadata = await ValidatorMetadata.new();\n   metadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, metadata.address);\n   \n   await proxyStorageMock.initializeAddresses(\n     keysManager.address,\n     masterOfCeremony,\n     masterOfCeremony,\n     masterOfCeremony,\n     ballotsStorage.address,\n     metadataEternalStorage.address\n   );\n   \n   metadata = await ValidatorMetadata.at(metadataEternalStorage.address);\n   \n   await keysManager.addMiningKey(miningKey).should.be.fulfilled;\n   await keysManager.addVotingKey(votingKey, miningKey).should.be.fulfilled;\n   await keysManager.addMiningKey(miningKey2).should.be.fulfilled;\n   await keysManager.addVotingKey(votingKey2, miningKey2).should.be.fulfilled;\n   await keysManager.addMiningKey(miningKey3).should.be.fulfilled;\n   await keysManager.addVotingKey(votingKey3, miningKey3).should.be.fulfilled;\n   await metadata.setTime(55555);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5bc7ba9f-9dbf-42ec-9dca-e1d6b5cd7496&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;999bfffc-b60b-4ecc-8c44-bed91e70f61b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;56056c03-5622-493e-b709-21fb9f3f08de&quot;,&quot;title&quot;:&quot;#createMetadata&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #createMetadata happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:110,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(&#x27;MetadataCreated&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d8a46151-ef38-4a30-93ce-b5c0b79306e2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if called by non-voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #createMetadata should not let create metadata if called by non-voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: miningKey}).should.be.rejectedWith(ERROR_MSG);\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;763cf823-820b-4668-9eb8-5749d94257b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if called second time&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #createMetadata should not let create metadata if called second time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:113,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8954eaca-538c-406d-801b-66bdab606eaa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d8a46151-ef38-4a30-93ce-b5c0b79306e2&quot;,&quot;763cf823-820b-4668-9eb8-5749d94257b7&quot;,&quot;8954eaca-538c-406d-801b-66bdab606eaa&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:285,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;dfdfa2c3-1b84-4cbc-983c-18db9327788f&quot;,&quot;title&quot;:&quot;#getMiningByVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #getMiningByVotingKey happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let actual = await metadata.getMiningByVotingKey(votingKey);\nminingKey.should.be.equal(actual);\nactual = await metadata.getMiningByVotingKey(accounts[4]);\n&#x27;0x0000000000000000000000000000000000000000&#x27;.should.be.equal(actual);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab3ccf24-56ee-4ac6-b743-c814d10f942b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ab3ccf24-56ee-4ac6-b743-c814d10f942b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:56,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;2b71ba42-6cfb-418f-954d-64a7e3211049&quot;,&quot;title&quot;:&quot;#changeRequest&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #changeRequest \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:76,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a738f190-08f1-4317-9b8a-2bcacf997740&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #changeRequest happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:151,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cddad70f-92fe-4854-bd6c-a3a03bed487f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let call if there is no metadata&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #changeRequest should not let call if there is no metadata&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.changeRequest(...newMetadata, {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b84a5486-a805-4da3-907c-c9128c564873&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;resets confirmations when changeRequest recreated&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #changeRequest resets confirmations when changeRequest recreated&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:440,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(4444);\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3});\nlet confirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(2);\nconst {logs} = await metadata.changeRequest(...anotherData, {from: votingKey}).should.be.fulfilled;\nconfirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(0);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nconfirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;04a3d9a2-87ae-47c8-b9c2-2ce9c13663d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cddad70f-92fe-4854-bd6c-a3a03bed487f&quot;,&quot;b84a5486-a805-4da3-907c-c9128c564873&quot;,&quot;04a3d9a2-87ae-47c8-b9c2-2ce9c13663d2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:630,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;dab740cb-2f22-46cc-8466-fe08c0ad03f3&quot;,&quot;title&quot;:&quot;#cancelPendingChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #cancelPendingChange happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:401,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;838a4a58-a94b-4e60-a6f3-95f7d98fbd96&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let delete records for someone else miningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #cancelPendingChange should not let delete records for someone else miningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:417,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.cancelPendingChange({from: votingKey2}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27370d65-8218-424f-8e5a-969efcf94d1b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;838a4a58-a94b-4e60-a6f3-95f7d98fbd96&quot;,&quot;27370d65-8218-424f-8e5a-969efcf94d1b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:818,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;6b54eb4d-d775-4573-bf5c-6e2daca833e1&quot;,&quot;title&quot;:&quot;#confirmPendingChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not let confirm your own changes&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #confirmPendingChange should not let confirm your own changes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:200,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97b10f62-7630-489d-b995-2f90ccbd0f41&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should confirm changes&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #confirmPendingChange should confirm changes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:267,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst {logs} = await metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nconst confirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Confirmed&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);\nlogs[0].args.votingSender.should.be.equal(votingKey2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e5ea52c-beee-4c6b-97a9-156320d69ff1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevent from double voting&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #confirmPendingChange prevent from double voting&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:274,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst {logs} = await metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nconst confirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e148086-15ee-4f7e-8306-77fe15e0bcc7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;97b10f62-7630-489d-b995-2f90ccbd0f41&quot;,&quot;5e5ea52c-beee-4c6b-97a9-156320d69ff1&quot;,&quot;3e148086-15ee-4f7e-8306-77fe15e0bcc7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:741,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;b71c40fa-9f65-4c17-9817-87f283beb7c2&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #finalize happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:560,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3});\nconst {logs} = await metadata.finalize(miningKey, {from: votingKey});\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nlogs[0].event.should.be.equal(&#x27;FinalizedChange&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9a0db80-999e-4df1-9d65-dca6ce1246c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b9a0db80-999e-4df1-9d65-dca6ce1246c1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:560,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;706f39f8-d4d7-40d5-b374-74dc195ca5ec&quot;,&quot;title&quot;:&quot;#getMinThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns default value&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #getMinThreshold returns default value&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await metadata.getMinThreshold()).should.be.bignumber.equal(2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;713fd0f3-80b4-4f5b-88e2-fe2f214ce84a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;713fd0f3-80b4-4f5b-88e2-fe2f214ce84a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ec3a0dc1-393a-4cbb-a6a1-50f73b012b57&quot;,&quot;title&quot;:&quot;#setProxyAddress&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can request a new proxy address&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #setProxyAddress can request a new proxy address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:275,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;\&quot;0x0000000000000000000000000000000000000000\&quot;.should.be.equal\n  (await metadata.pendingProxyStorage());\n(await metadata.proxyStorage()).should.be.equal(proxyStorageMock.address);\nconst {logs} = await metadata.setProxyAddress(newProxy, {from: votingKey}).should.be.fulfilled;\n(await metadata.pendingProxyStorage()).should.be.equal(newProxy);\n(await metadata.pendingProxyConfirmations(newProxy))[0].should.be.bignumber.deep.equal(1);\nlogs[0].event.should.be.equal(\&quot;RequestForNewProxy\&quot;);\nlogs[0].args.newProxyAddress.should.be.equal(newProxy);\nawait metadata.confirmNewProxyAddress(newProxy, {from :votingKey2}).should.be.fulfilled;\n(await metadata.pendingProxyConfirmations(newProxy))[0].should.be.bignumber.deep.equal(2);\nlet final = await metadata.confirmNewProxyAddress(newProxy, {from: votingKey3}).should.be.fulfilled;\nfinal.logs[0].event.should.be.equal(\&quot;ChangeProxyStorage\&quot;);\nfinal.logs[0].args.newProxyAddress.should.be.equal(newProxy);\n\&quot;0x0000000000000000000000000000000000000000\&quot;.should.be.equal\n  (await metadata.pendingProxyStorage());\n(await metadata.proxyStorage()).should.be.equal(newProxy);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed565314-2147-4553-86f0-56e5a8630445&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ed565314-2147-4553-86f0-56e5a8630445&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:275,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;0871bbab-9c90-418b-b392-d860e294442c&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;metadata = await ValidatorMetadata.new();\nmetadataEternalStorage = await EternalStorageProxy.new(proxyStorageStubAddress, metadata.address);\nmetadata = await ValidatorMetadata.at(metadataEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fc3020d6-a9b0-414a-8cdc-33f20b55773f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may be called only by ProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo may be called only by ProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: proxyStorageStubAddress}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;01fedfe1-be70-4ade-9e23-bb6d91d83443&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:121,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nlet oldImplementation = await metadata.implementation();\nlet newImplementation = metadataNew.address;\n(await metadataEternalStorage.implementation()).should.be.equal(oldImplementation);\nawait metadataEternalStorage.upgradeTo(newImplementation, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\n(await metadataNew.implementation()).should.be.equal(newImplementation);\n(await metadataEternalStorage.implementation()).should.be.equal(newImplementation);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49056d92-42a9-4b42-8959-f3dfc363e258&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment implementation version&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo should increment implementation version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:119,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nlet oldVersion = await metadata.version();\nlet newVersion = oldVersion.add(1);\n(await metadataEternalStorage.version()).should.be.bignumber.equal(oldVersion);\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\n(await metadataNew.version()).should.be.bignumber.equal(newVersion);\n(await metadataEternalStorage.version()).should.be.bignumber.equal(newVersion);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6205212-198b-414e-9408-2a6097b1a875&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should work&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo new implementation should work&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:166,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\n(await metadataNew.initialized()).should.be.equal(false);\nawait metadataNew.initialize();\n(await metadataNew.initialized()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6648239c-8fb4-437b-88f7-1fd7932e3f11&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same proxyStorage address&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo new implementation should use the same proxyStorage address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\n(await metadataNew.proxyStorage()).should.be.equal(proxyStorageStubAddress);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;731fd39a-750a-4dad-b143-cd54d9f6755c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same storage&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo new implementation should use the same storage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:280,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(55555);\nawait metadataEternalStorage.setProxyStorage(proxyStorageMock.address);\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadataEternalStorage.setProxyStorage(proxyStorageStubAddress);\nlet metadataNew = await ValidatorMetadataNew.new();\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\nconst validators = await metadataNew.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d5c5272-78d0-4aea-97cb-3dcda52a55f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;01fedfe1-be70-4ade-9e23-bb6d91d83443&quot;,&quot;49056d92-42a9-4b42-8959-f3dfc363e258&quot;,&quot;b6205212-198b-414e-9408-2a6097b1a875&quot;,&quot;6648239c-8fb4-437b-88f7-1fd7932e3f11&quot;,&quot;731fd39a-750a-4dad-b143-cd54d9f6755c&quot;,&quot;1d5c5272-78d0-4aea-97cb-3dcda52a55f4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:871,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;fcc13400-549b-4a55-9f33-9b84723e3e69&quot;,&quot;title&quot;:&quot;Contract: ValidatorMetadata upgraded [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1144,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;247cd4fb-3aca-4c04-8382-3064838d5364&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d8dc3557-c035-4c33-aca6-440cfb897fd3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:794,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n   proxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensusMock.address);\n   keysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\n   ballotsStorage = await BallotsStorage.new(proxyStorageMock.address);\n   await poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\n   metadata = await ValidatorMetadata.new();\n   metadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, metadata.address);\n   await proxyStorageMock.initializeAddresses(\n     keysManager.address,\n     masterOfCeremony,\n     masterOfCeremony,\n     masterOfCeremony,\n     ballotsStorage.address,\n     metadataEternalStorage.address\n   );\n   //metadata = await ValidatorMetadata.at(metadataEternalStorage.address);\n   let metadataNew = await ValidatorMetadataNew.new();\n   await metadataEternalStorage.setProxyStorage(accounts[6]);\n   await metadataEternalStorage.upgradeTo(metadataNew.address, {from: accounts[6]});\n   await metadataEternalStorage.setProxyStorage(proxyStorageMock.address);\n   metadata = await ValidatorMetadataNew.at(metadataEternalStorage.address);\n   await keysManager.addMiningKey(miningKey).should.be.fulfilled;\n   await keysManager.addVotingKey(votingKey, miningKey).should.be.fulfilled;\n   await keysManager.addMiningKey(miningKey2).should.be.fulfilled;\n   await keysManager.addVotingKey(votingKey2, miningKey2).should.be.fulfilled;\n   await keysManager.addMiningKey(miningKey3).should.be.fulfilled;\n   await keysManager.addVotingKey(votingKey3, miningKey3).should.be.fulfilled;\n   await metadata.setTime(55555);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;068a534d-c6cb-462d-a5c2-800cf888e539&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;285d3631-2159-4edb-b4dc-e880086d5980&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;44a512b8-61a9-41c5-ad9c-da08361de02c&quot;,&quot;title&quot;:&quot;#createMetadata&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #createMetadata happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:103,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(&#x27;MetadataCreated&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b02562f-b764-458a-9657-2e1573635336&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if called by non-voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #createMetadata should not let create metadata if called by non-voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: miningKey}).should.be.rejectedWith(ERROR_MSG);\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97be47d9-dabc-4b59-8e70-62668dfdb39e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if called second time&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #createMetadata should not let create metadata if called second time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:112,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a77573d9-1178-49c1-8f04-8ca879036dc9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9b02562f-b764-458a-9657-2e1573635336&quot;,&quot;97be47d9-dabc-4b59-8e70-62668dfdb39e&quot;,&quot;a77573d9-1178-49c1-8f04-8ca879036dc9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:277,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;52b0e0a0-9465-4d25-8e7a-a6e3845ed6b3&quot;,&quot;title&quot;:&quot;#getMiningByVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #getMiningByVotingKey happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let actual = await metadata.getMiningByVotingKey(votingKey);\nminingKey.should.be.equal(actual);\nactual = await metadata.getMiningByVotingKey(accounts[4]);\n&#x27;0x0000000000000000000000000000000000000000&#x27;.should.be.equal(actual);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c24370c5-15c8-407b-94a2-884fceb3dd2b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c24370c5-15c8-407b-94a2-884fceb3dd2b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:45,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;fdf6645e-faac-4d1c-8494-4b78dca387ea&quot;,&quot;title&quot;:&quot;#changeRequest&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #changeRequest \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5d84fec-4706-47e8-99cc-2595a6dbf20c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #changeRequest happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:147,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\npendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;67545c75-af8f-45df-b4c7-6445142af156&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let call if there is no metadata&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #changeRequest should not let call if there is no metadata&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.changeRequest(...newMetadata, {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0257ce92-83bb-47d4-a8fe-6e5a1975172d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;resets confirmations when changeRequest recreated&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #changeRequest resets confirmations when changeRequest recreated&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:414,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(4444);\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3});\nlet confirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(2);\nconst {logs} = await metadata.changeRequest(...anotherData, {from: votingKey}).should.be.fulfilled;\nconfirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(0);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nconfirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5917d589-44c0-47ca-9235-9b4f4a291798&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;67545c75-af8f-45df-b4c7-6445142af156&quot;,&quot;0257ce92-83bb-47d4-a8fe-6e5a1975172d&quot;,&quot;5917d589-44c0-47ca-9235-9b4f4a291798&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:592,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;3e3e29c2-da35-4c40-a9ae-2381df1a9079&quot;,&quot;title&quot;:&quot;#cancelPendingChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #cancelPendingChange happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:360,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6aadf7df-f0ad-42a5-bdd5-b4c556177b07&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let delete records for someone else miningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #cancelPendingChange should not let delete records for someone else miningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:420,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.cancelPendingChange({from: votingKey2}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f478a80-4745-4f72-a054-202c98cff350&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6aadf7df-f0ad-42a5-bdd5-b4c556177b07&quot;,&quot;4f478a80-4745-4f72-a054-202c98cff350&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:780,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;f9d21a38-24da-4405-9b69-5c5985582780&quot;,&quot;title&quot;:&quot;#confirmPendingChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not let confirm your own changes&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #confirmPendingChange should not let confirm your own changes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:203,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc5658b2-43aa-462b-afdf-75e5cc4a832b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should confirm changes&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #confirmPendingChange should confirm changes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:227,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst {logs} = await metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nconst confirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Confirmed&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);\nlogs[0].args.votingSender.should.be.equal(votingKey2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;907910f9-9144-4d2d-8f24-46934883134f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevent from double voting&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #confirmPendingChange prevent from double voting&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:286,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst {logs} = await metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nconst confirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0341181-79ee-41ab-b741-90ad583186da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bc5658b2-43aa-462b-afdf-75e5cc4a832b&quot;,&quot;907910f9-9144-4d2d-8f24-46934883134f&quot;,&quot;f0341181-79ee-41ab-b741-90ad583186da&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:716,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;62ad3907-2acd-4555-b7df-79a0ad7ee173&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #finalize happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:527,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3});\nconst {logs} = await metadata.finalize(miningKey, {from: votingKey});\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nlogs[0].event.should.be.equal(&#x27;FinalizedChange&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4fb2dff2-cfad-4e9e-b109-412ba0b050a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4fb2dff2-cfad-4e9e-b109-412ba0b050a1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:527,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;cc2d6914-dd6a-4801-9665-7b0ce26f8724&quot;,&quot;title&quot;:&quot;#getMinThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns default value&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #getMinThreshold returns default value&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await metadata.getMinThreshold()).should.be.bignumber.equal(2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ea2d7d4-722f-4bf3-a9ee-16db2ff02584&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8ea2d7d4-722f-4bf3-a9ee-16db2ff02584&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;22937214-23e5-4f58-9cc1-b758094ce12c&quot;,&quot;title&quot;:&quot;#setProxyAddress&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can request a new proxy address&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #setProxyAddress can request a new proxy address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:401,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;\&quot;0x0000000000000000000000000000000000000000\&quot;.should.be.equal\n  (await metadata.pendingProxyStorage());\n(await metadata.proxyStorage()).should.be.equal(proxyStorageMock.address);\nconst {logs} = await metadata.setProxyAddress(newProxy, {from: votingKey}).should.be.fulfilled;\n(await metadata.pendingProxyStorage()).should.be.equal(newProxy);\n(await metadata.pendingProxyConfirmations(newProxy))[0].should.be.bignumber.deep.equal(1);\nlogs[0].event.should.be.equal(\&quot;RequestForNewProxy\&quot;);\nlogs[0].args.newProxyAddress.should.be.equal(newProxy);\nawait metadata.confirmNewProxyAddress(newProxy, {from :votingKey2}).should.be.fulfilled;\n(await metadata.pendingProxyConfirmations(newProxy))[0].should.be.bignumber.deep.equal(2);\nlet final = await metadata.confirmNewProxyAddress(newProxy, {from: votingKey3}).should.be.fulfilled;\nfinal.logs[0].event.should.be.equal(\&quot;ChangeProxyStorage\&quot;);\nfinal.logs[0].args.newProxyAddress.should.be.equal(newProxy);\n\&quot;0x0000000000000000000000000000000000000000\&quot;.should.be.equal\n  (await metadata.pendingProxyStorage());\n(await metadata.proxyStorage()).should.be.equal(newProxy);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;435cc7fa-cf21-4b00-ae08-ee6bd46ca19c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;435cc7fa-cf21-4b00-ae08-ee6bd46ca19c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:401,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;d085e325-262c-4ffb-bc36-e7ea194e3845&quot;,&quot;title&quot;:&quot;Contract: PoaNetworkConsensus [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:947,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0a37152c-67cb-41cd-98de-9c9a99238a4d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;43bb9fc5-de63-41a1-ae58-652d34e8dcf4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:186,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\nproxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensus.address);\nawait poaNetworkConsensus.setProxyStorage(proxyStorageMock.address);\nawait proxyStorageMock.initializeAddresses(\n    masterOfCeremony,\n    masterOfCeremony,\n    masterOfCeremony,\n    masterOfCeremony,\n    masterOfCeremony,\n    masterOfCeremony\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44a8f771-d868-43ea-b93d-d71b2ed5d0f3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25106d76-8be6-4209-8f41-42c60edf51cd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;030f13c6-106a-4e7f-80a3-34107733b032&quot;,&quot;title&quot;:&quot;default values&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;finalized should be false&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] default values finalized should be false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validators = await poaNetworkConsensus.getValidators();\nlet finalized = await poaNetworkConsensus.finalized();\nvalidators.should.be.deep.equal([\n    masterOfCeremony\n]);\nfinalized.should.be.false;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6a386de-5d20-46c2-9169-e328f229000f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;checks systemAddress&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] default values checks systemAddress&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let systemAddress = await poaNetworkConsensus.systemAddress();\nsystemAddress.should.be.equal(&#x27;0xfffffffffffffffffffffffffffffffffffffffe&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66bbf1d0-058f-451e-a30c-b3947d17f853&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;allows you to set current list of validators&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] default values allows you to set current list of validators&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validatorsList = [accounts[2], accounts[3], accounts[4]];\nlet poa = await PoaNetworkConsensus.new(masterOfCeremony, validatorsList);\nlet validators = await poa.getValidators();\nlet finalized = await poa.finalized();\nvalidators.should.be.deep.equal([\n    masterOfCeremony,\n    ...validatorsList\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7cf65c9c-2fdb-414b-8636-eb261272f1d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f6a386de-5d20-46c2-9169-e328f229000f&quot;,&quot;66bbf1d0-058f-451e-a30c-b3947d17f853&quot;,&quot;7cf65c9c-2fdb-414b-8636-eb261272f1d0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:150,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;0c5a6c45-458f-4b7f-90cd-288257a16366&quot;,&quot;title&quot;:&quot;#finalizeChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should only be called by systemAddress&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #finalizeChange should only be called by systemAddress&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:84,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.finalizeChange().should.be.rejectedWith(ERROR_MSG);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.finalizeChange().should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2977bfc2-bd4f-4729-b061-1e1c40234300&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set finalized to true&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #finalizeChange should set finalized to true&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:74,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let finalized = await poaNetworkConsensus.finalized();\nfinalized.should.be.false;\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nfinalized = await poaNetworkConsensus.finalized();\nfinalized.should.be.true;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;89a91be8-5893-4374-8f85-7dafcf63913d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set currentValidators to pendingList&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #finalizeChange should set currentValidators to pendingList&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.setSystemAddress(accounts[0]);\nconst { logs } = await poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensus.currentValidatorsLength();\nlet currentValidators = [];\nlet pendingList = [];\nfor (let i = 0; i &lt; currentValidatorsLength.toNumber(10); i++) {\n    let validator = await poaNetworkConsensus.currentValidators(i);\n    currentValidators.push(validator);\n    let pending = await poaNetworkConsensus.pendingList(i);\n    pendingList.push(pending);\n}\ncurrentValidators.should.be.deep.equal(pendingList);\nlogs[0].event.should.be.equal(&#x27;ChangeFinalized&#x27;);\nlogs[0].args.newSet.should.be.deep.equal(currentValidators);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60b74eec-d8d3-42c8-aba3-9759d22c02b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;set currentValidators to pendingList after addValidator call&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #finalizeChange set currentValidators to pendingList after addValidator call&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:355,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.addValidator(accounts[1], true, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait poaNetworkConsensus.addValidator(accounts[1], true);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensus.currentValidatorsLength();\nlet currentValidators = [];\nlet pendingList = [];\nfor (let i = 0; i &lt; currentValidatorsLength.toNumber(10); i++) {\n    let validator = await poaNetworkConsensus.currentValidators(i);\n    currentValidators.push(validator);\n    let pending = await poaNetworkConsensus.pendingList(i);\n    pendingList.push(pending);\n}\ncurrentValidators.should.be.deep.equal(pendingList);\nawait poaNetworkConsensus.addValidator(accounts[2], true);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\ncurrentValidatorsLength = await poaNetworkConsensus.currentValidatorsLength()\nconst expected = [masterOfCeremony, accounts[1], accounts[2]];\ncurrentValidatorsLength = await poaNetworkConsensus.currentValidatorsLength();\ncurrentValidators = [];\npendingList = [];\nfor (let i = 0; i &lt; currentValidatorsLength.toNumber(10); i++) {\n    let validator = await poaNetworkConsensus.currentValidators(i);\n    currentValidators.push(validator);\n    let pending = await poaNetworkConsensus.pendingList(i);\n    pendingList.push(pending);\n}\nexpected.should.be.deep.equal(pendingList);\nexpected.should.be.deep.equal(currentValidators);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a1efe011-5135-4acf-9010-12a356382e8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2977bfc2-bd4f-4729-b061-1e1c40234300&quot;,&quot;89a91be8-5893-4374-8f85-7dafcf63913d&quot;,&quot;60b74eec-d8d3-42c8-aba3-9759d22c02b1&quot;,&quot;a1efe011-5135-4acf-9010-12a356382e8d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:604,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5990e5e5-6a24-4d64-a05c-829961bf308b&quot;,&quot;title&quot;:&quot;#addValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should be called only from keys manager&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should be called only from keys manager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.addValidator(accounts[1], true, {from: accounts[2]}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorageMock.setKeysManagerMock(accounts[5]);\nawait poaNetworkConsensus.addValidator(accounts[1], true, {from: accounts[5]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;64ac1fd6-8470-4f13-8a58-4c2a9d24c73d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to add already existing validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should not allow to add already existing validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:74,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b49a6558-a7a5-4da1-bc82-7938c15e2bea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow 0x0 addresses&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should not allow 0x0 addresses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(&#x27;0x0&#x27;, true).should.be.rejectedWith(ERROR_MSG);\nawait poaNetworkConsensus.addValidator(&#x27;0x0000000000000000000000000000000000000000&#x27;, true).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d872964b-7e1c-40d3-8aa6-f26b4e44f594&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorsState for new validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should set validatorsState for new validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nlet state = await poaNetworkConsensus.validatorsState(accounts[1]);\nlet pendingList = await poaNetworkConsensus.getPendingList();\nstate[0].should.be.true;\nstate[1].should.be.bignumber.equal(pendingList.length - 1)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4060e03-ff85-4252-a085-218be8a43118&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set finalized to false&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should set finalized to false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nlet finalized = await poaNetworkConsensus.finalized();\nfinalized.should.be.false;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bb92290b-48f9-4221-a3e5-d3ec547b95cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit InitiateChange with blockhash and pendingList as params&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should emit InitiateChange with blockhash and pendingList as params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nconst {logs} = await poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensus.currentValidatorsLength();\nlet currentValidators = [];\nfor (let i = 0; i &lt; currentValidatorsLength.toNumber(10); i++) {\n    let validator = await poaNetworkConsensus.currentValidators(i);\n    currentValidators.push(validator);\n}\ncurrentValidators.push(accounts[1]);\nlogs[0].args[&#x27;newSet&#x27;].should.deep.equal(currentValidators);  \nlogs[0].event.should.be.equal(&#x27;InitiateChange&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ecf3d33f-e0e0-47ae-bf50-df463b6226dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;64ac1fd6-8470-4f13-8a58-4c2a9d24c73d&quot;,&quot;b49a6558-a7a5-4da1-bc82-7938c15e2bea&quot;,&quot;d872964b-7e1c-40d3-8aa6-f26b4e44f594&quot;,&quot;d4060e03-ff85-4252-a085-218be8a43118&quot;,&quot;bb92290b-48f9-4221-a3e5-d3ec547b95cf&quot;,&quot;ecf3d33f-e0e0-47ae-bf50-df463b6226dc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:441,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e47bbcd6-d795-4d09-8f2f-25606a29a363&quot;,&quot;title&quot;:&quot;#removeValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should remove validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should remove validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:133,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nawait poaNetworkConsensus.removeValidator(accounts[1], true).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b8c0e026-4760-44e3-ac42-c33acb64a299&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should be called only from keys manager&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should be called only from keys manager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:130,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.removeValidator(accounts[1],true).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nawait poaNetworkConsensus.removeValidator(accounts[1],true).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55f39ff2-8fdd-410b-981a-84f86a388127&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be allowed to remove from existing set of validators&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should only be allowed to remove from existing set of validators&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.removeValidator(accounts[1],true).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a298ac9-4b76-4c36-8057-ef8b7492be77&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should decrease length of pendingList&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should decrease length of pendingList&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:266,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.addValidator(accounts[2], true).should.be.fulfilled;\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensus.currentValidatorsLength();\nlet pendingList = [];\nfor(let i = 0; i &lt; currentValidatorsLength; i++){\n    let pending = await poaNetworkConsensus.pendingList(i);\n    pendingList.push(pending);\n}\nconst indexOfRemovedElement = pendingList.indexOf(accounts[1]);\npendingList.splice(indexOfRemovedElement, 1);\nconst { logs } = await poaNetworkConsensus.removeValidator(accounts[1],true).should.be.fulfilled;\nlet pendingListFromContract = logs[0].args[&#x27;newSet&#x27;];\npendingListFromContract.length.should.be.equal(currentValidatorsLength.toNumber(10) - 1);\npendingList.should.be.deep.equal(pendingListFromContract);\nlogs[0].event.should.be.equal(&#x27;InitiateChange&#x27;);\nconst expected = [masterOfCeremony, accounts[2]];\nexpected.should.be.deep.equal(pendingList);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f1696359-05f6-4ac7-bd9b-eeac7640264e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change validatorsState&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should change validatorsState&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:104,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nawait poaNetworkConsensus.removeValidator(accounts[1],true).should.be.fulfilled;\nconst state = await poaNetworkConsensus.validatorsState(accounts[1]);\nstate[0].should.be.false;\nstate[1].should.be.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc1ea7c1-9b65-459a-b508-daa591535881&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set finalized to false&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should set finalized to false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:121,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nawait poaNetworkConsensus.removeValidator(accounts[1],true).should.be.fulfilled;\nconst finalized = await poaNetworkConsensus.finalized();\nfinalized.should.be.false;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9344a68b-9205-408c-b09d-4f4be0192573&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b8c0e026-4760-44e3-ac42-c33acb64a299&quot;,&quot;55f39ff2-8fdd-410b-981a-84f86a388127&quot;,&quot;9a298ac9-4b76-4c36-8057-ef8b7492be77&quot;,&quot;f1696359-05f6-4ac7-bd9b-eeac7640264e&quot;,&quot;bc1ea7c1-9b65-459a-b508-daa591535881&quot;,&quot;9344a68b-9205-408c-b09d-4f4be0192573&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:797,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;669c8429-dfd4-4e65-af28-33ccf4f3caa4&quot;,&quot;title&quot;:&quot;#setProxyStorage&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can be called by any validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage can be called by any validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nawait poaNetworkConsensus.setProxyStorage(nonValidator, {from: accounts[6]}).should.be.rejectedWith(ERROR_MSG);\nawait poaNetworkConsensus.setProxyStorage(accounts[5], {from: validator}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6442dce-5e51-4415-9c34-ecf9d038af7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;can only be called once&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage can only be called once&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// we already call it in the beforeEach block, hence why I expect it to be rejected\nawait poaNetworkConsensus.setProxyStorage(nonValidator, {from: nonValidator}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c2ef694a-f8ac-4c33-ae5a-da9025a89fab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be set to 0x0 address&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage cannot be set to 0x0 address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nawait poaNetworkConsensus.setProxyStorage(&#x27;0x0000000000000000000000000000000000000000&#x27;, {from: validator}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d95b6a10-3868-434a-8a9b-41c5c8d15719&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets proxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage sets proxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newProxyStorage = accounts[3];\nawait poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nawait poaNetworkConsensus.setProxyStorage(newProxyStorage, {from: validator}).should.be.fulfilled;\n(await poaNetworkConsensus.proxyStorage()).should.be.equal(newProxyStorage);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;620ab848-2ed7-438b-acf1-9d54f4a7d173&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets isMasterOfCeremonyInitialized&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage sets isMasterOfCeremonyInitialized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newProxyStorage = accounts[3];\nawait poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nawait poaNetworkConsensus.setProxyStorage(newProxyStorage, {from: validator}).should.be.fulfilled;\n(await poaNetworkConsensus.isMasterOfCeremonyInitialized()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b41b4019-ad95-4b8d-b08f-f4fb82dd0bb0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;emits MoCInitializedProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage emits MoCInitializedProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newProxyStorage = accounts[3];\nawait poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nconst {logs} = await poaNetworkConsensus.setProxyStorage(newProxyStorage, {from: validator}).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;MoCInitializedProxyStorage&#x27;);\nlogs[0].args.proxyStorage.should.be.equal(newProxyStorage);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;54581874-41a3-4954-99c4-e308d5343cda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#getKeysManager&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage #getKeysManager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newKeysManager = accounts[3];\nawait poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nawait proxyStorageMock.setKeysManagerMock(newKeysManager);\n(await poaNetworkConsensus.getKeysManager()).should.be.equal(newKeysManager);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3e8af9b-35ff-4c62-b2e5-d86b2d4b66d9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#getVotingToChangeKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage #getVotingToChangeKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newVotingToChangeKeys = accounts[3];\nawait poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nawait proxyStorageMock.setVotingContractMock(newVotingToChangeKeys);\n(await poaNetworkConsensus.getVotingToChangeKeys()).should.be.equal(newVotingToChangeKeys);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e02840f-28a7-4788-9cfa-7d3167258da8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b6442dce-5e51-4415-9c34-ecf9d038af7f&quot;,&quot;c2ef694a-f8ac-4c33-ae5a-da9025a89fab&quot;,&quot;d95b6a10-3868-434a-8a9b-41c5c8d15719&quot;,&quot;620ab848-2ed7-438b-acf1-9d54f4a7d173&quot;,&quot;b41b4019-ad95-4b8d-b08f-f4fb82dd0bb0&quot;,&quot;54581874-41a3-4954-99c4-e308d5343cda&quot;,&quot;d3e8af9b-35ff-4c62-b2e5-d86b2d4b66d9&quot;,&quot;5e02840f-28a7-4788-9cfa-7d3167258da8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:393,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;109de2ad-c24b-4350-adee-bffa9c5f0cb9&quot;,&quot;title&quot;:&quot;#isValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns address of miner&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #isValidator returns address of miner&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await poaNetworkConsensus.isValidator(masterOfCeremony)).should.be.equal(true);\n(await poaNetworkConsensus.isValidator(accounts[2])).should.be.equal(false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f3f202d1-d9b8-4a1d-b07a-631afab6044d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f3f202d1-d9b8-4a1d-b07a-631afab6044d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:23,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;4253d239-cea2-44f9-80cd-5a4e50382aeb&quot;,&quot;title&quot;:&quot;Contract: ProxyStorage [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:493,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;afaa859a-e9ff-44ca-b519-e6fbecfa4bf5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab1369cf-fd1b-4e17-9b00-2f0843463043&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:187,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\nproxyStorage = await ProxyStorageMock.new(poaNetworkConsensus.address);\nvalidatorMetadata = await ValidatorMetadata.new();\nvalidatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;977121d5-58f9-42c5-8178-274820572e0d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d490e940-5e6d-4e37-8d95-e23ed482263c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cc993880-0cd4-4a1a-9cc4-744b9d674948&quot;,&quot;title&quot;:&quot;#constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets MoC and Poa&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #constructor sets MoC and Poa&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensus.address.should.be.equal(\n  await proxyStorage.getPoaConsensus()\n);\ntrue.should.be.equal(\n  await proxyStorage.isValidator(masterOfCeremony)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c143694-324f-42d2-9b0b-7c81e4aca865&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1c143694-324f-42d2-9b0b-7c81e4aca865&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;6e9dedfa-f96b-40bd-9b86-c2197c5580cb&quot;,&quot;title&quot;:&quot;#initializeAddresses&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets all addresses&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #initializeAddresses sets all addresses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:132,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.initializeAddresses(\n  keysManager,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  ballotsStorage,\n  validatorMetadataEternalStorage.address,\n  {from: accounts[2]}\n).should.be.rejectedWith(ERROR_MSG);\nconst {logs} = await proxyStorage.initializeAddresses(\n  keysManager,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  ballotsStorage,\n  validatorMetadataEternalStorage.address,\n).should.be.fulfilled;\nkeysManager.should.be.equal(\n  await proxyStorage.getKeysManager()\n);\nvotingToChangeKeys.should.be.equal(\n  await proxyStorage.getVotingToChangeKeys()\n);\nvotingToChangeMinThreshold.should.be.equal(\n  await proxyStorage.getVotingToChangeMinThreshold()\n);\nvotingToChangeProxy.should.be.equal(\n  await proxyStorage.getVotingToChangeProxy()\n);\nballotsStorage.should.be.equal(\n  await proxyStorage.getBallotsStorage()\n);\nvalidatorMetadataEternalStorage.address.should.be.equal(\n  await proxyStorage.getValidatorMetadata()\n);\nlogs[0].event.should.be.equal(&#x27;ProxyInitialized&#x27;);\nlogs[0].args.keysManager.should.be.equal(keysManager);\nlogs[0].args.votingToChangeKeys.should.be.equal(votingToChangeKeys);\nlogs[0].args.votingToChangeMinThreshold.should.be.equal(votingToChangeMinThreshold);\nlogs[0].args.votingToChangeProxy.should.be.equal(votingToChangeProxy);\nlogs[0].args.ballotsStorage.should.be.equal(ballotsStorage);\nlogs[0].args.validatorMetadataEternalStorage.should.be.equal(validatorMetadataEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;594e73da-7fb7-44ef-aa78-d2ef4fc0e9f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents Moc to call it more than once&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #initializeAddresses prevents Moc to call it more than once&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;false.should.be.equal(await proxyStorage.mocInitialized());\nconst {logs} = await proxyStorage.initializeAddresses(\n  keysManager,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  ballotsStorage,\n  validatorMetadataEternalStorage.address\n).should.be.fulfilled;\ntrue.should.be.equal(await proxyStorage.mocInitialized());\nawait proxyStorage.initializeAddresses(\n  keysManager,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  ballotsStorage,\n  validatorMetadataEternalStorage.address\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;89e2cd9c-1abe-43fc-85fa-9c4405c328be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;594e73da-7fb7-44ef-aa78-d2ef4fc0e9f5&quot;,&quot;89e2cd9c-1abe-43fc-85fa-9c4405c328be&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:223,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ff2787a5-8df4-4b27-8957-be7f50c0e9f8&quot;,&quot;title&quot;:&quot;#setContractAddress&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.initializeAddresses(\n  keysManager,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  ballotsStorage,\n  validatorMetadataEternalStorage.address,\n  {from: masterOfCeremony}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e862080-8824-45f9-9ec9-70ac702ca897&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can only be called from votingToChangeProxy address&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress can only be called from votingToChangeProxy address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(1, accounts[2], {from: votingToChangeKeys}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorage.setContractAddress(1, accounts[2], {from: votingToChangeProxy}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8809eede-eeb8-4d2b-8a91-c2c5745b9c65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be set to 0x0 address&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress cannot be set to 0x0 address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(1, &#x27;0x0000000000000000000000000000000000000000&#x27;, {from: votingToChangeProxy}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e49717a5-b56c-46a5-910e-ef6c9a9d88a9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets keysManager&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets keysManager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(1, accounts[2], {from: votingToChangeProxy}).should.be.fulfilled;\naccounts[2].should.be.equal(\n  await proxyStorage.getKeysManager()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1f22f708-17bc-413a-849e-67f6aba0be0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets votingToChangeKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets votingToChangeKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(2, accounts[1], {from: votingToChangeProxy}).should.be.fulfilled;\naccounts[1].should.be.equal(\n  await proxyStorage.getVotingToChangeKeys()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ad0a9c1-b146-4a73-9f15-e2dda2a91173&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets votingToChangeMinThreshold&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets votingToChangeMinThreshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(3, accounts[2], {from: votingToChangeProxy}).should.be.fulfilled;\naccounts[2].should.be.equal(\n  await proxyStorage.getVotingToChangeMinThreshold()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97d7c73e-19fd-450d-b7be-b9633127a865&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets votingToChangeProxy&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets votingToChangeProxy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(4, accounts[3], {from: votingToChangeProxy}).should.be.fulfilled;\naccounts[3].should.be.equal(\n  await proxyStorage.getVotingToChangeProxy()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;723dcc8d-fbd2-4f05-bf05-5c6775b1597f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets ballotsStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets ballotsStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(5, accounts[4], {from: votingToChangeProxy}).should.be.fulfilled;\naccounts[4].should.be.equal(\n  await proxyStorage.getBallotsStorage()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb8861d4-e183-42c3-a230-f09c0d25b446&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(6, accounts[5], {from: votingToChangeProxy}).should.be.fulfilled;\naccounts[5].should.be.equal(\n  await proxyStorage.getPoaConsensus()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9b7ee9e-f089-4571-b0a1-6e49878ab5cc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets validatorMetadata&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets validatorMetadata&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:106,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validatorMetadataNew = await ValidatorMetadata.new();\nawait proxyStorage.setContractAddress(7, validatorMetadataNew.address, {from: votingToChangeProxy}).should.be.fulfilled;\n\nlet eternalProxyAddress = await proxyStorage.getValidatorMetadata();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nvalidatorMetadataNew.address.should.be.equal(\n  await eternalProxy.implementation()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;312ac78c-b3bd-474a-a953-631477f0f61b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets validatorMetadataEternalStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets validatorMetadataEternalStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validatorMetadataEternalStorageNew = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);\nawait proxyStorage.setContractAddress(8, validatorMetadataEternalStorageNew.address, {from: votingToChangeProxy}).should.be.fulfilled;\nvalidatorMetadataEternalStorageNew.address.should.be.equal(\n  await proxyStorage.getValidatorMetadata()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec51ae7a-8dae-4706-9198-c13523d63a46&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8809eede-eeb8-4d2b-8a91-c2c5745b9c65&quot;,&quot;e49717a5-b56c-46a5-910e-ef6c9a9d88a9&quot;,&quot;1f22f708-17bc-413a-849e-67f6aba0be0c&quot;,&quot;4ad0a9c1-b146-4a73-9f15-e2dda2a91173&quot;,&quot;97d7c73e-19fd-450d-b7be-b9633127a865&quot;,&quot;723dcc8d-fbd2-4f05-bf05-5c6775b1597f&quot;,&quot;cb8861d4-e183-42c3-a230-f09c0d25b446&quot;,&quot;a9b7ee9e-f089-4571-b0a1-6e49878ab5cc&quot;,&quot;312ac78c-b3bd-474a-a953-631477f0f61b&quot;,&quot;ec51ae7a-8dae-4706-9198-c13523d63a46&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:457,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;876ee809-3fc3-4e1e-875f-66a5eeecee50&quot;,&quot;title&quot;:&quot;Contract: Voting to change keys [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:282,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95a9c1e2-8f3f-402a-b075-f68fd6f7b6f9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;457b6345-a553-4a58-97ba-30ea31119bd7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:288,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\nproxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensusMock.address);\nkeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\nballotsStorage = await BallotsStorage.new(proxyStorageMock.address);\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nvoting = await VotingToChangeKeysMock.new(proxyStorageMock.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  voting.address,\n  masterOfCeremony,\n  masterOfCeremony,\n  ballotsStorage.address,\n  masterOfCeremony\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8748efa1-76e3-42bf-bb3d-49bb65b14b67&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0537651e-ef7c-4b15-98f1-294510fac22a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ebee7269-aab0-42b8-888a-4444a4849e65&quot;,&quot;title&quot;:&quot;#constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #constructor happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:338,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nconst VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nconst VOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId();\nconst {logs} = await voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;,{from: votingKey});\nconst startTime = await voting.getStartTime(id.toNumber());\nconst endTime = await voting.getEndTime(id.toNumber());\nconst keysManagerFromContract = await voting.getKeysManager();\nstartTime.should.be.bignumber.equal(VOTING_START_DATE);\nendTime.should.be.bignumber.equal(VOTING_END_DATE);\nkeysManagerFromContract.should.be.equal(keysManager.address);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8564106d-8aa3-4053-820b-835b80e74464&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create voting with invalid duration&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #constructor should not let create voting with invalid duration&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let VOTING_START_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nlet VOTING_END_DATE = moment.utc().add(2, &#x27;seconds&#x27;).unix();\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = 0\nVOTING_END_DATE = moment.utc().add(2, &#x27;seconds&#x27;).unix();\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = moment.utc().add(2, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = 0\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d387ebe-baea-4aa6-b8ff-7004e6d4d90e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create more ballots than the limit&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #constructor should not let create more ballots than the limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8836,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nconst VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nconst VOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;, {from: votingKey});\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;, {from: votingKey});\nnew web3.BigNumber(200).should.be.bignumber.equal(await voting.getBallotLimitPerValidator());\nawait addValidators({proxyStorageMock, keysManager, poaNetworkConsensusMock}); //add 100 validators, so total will be 101 validator\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getBallotLimitPerValidator());\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;, {from: votingKey}).should.be.rejectedWith(ERROR_MSG)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c4094725-9e1a-4f13-ab85-56cd44d2d22f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8564106d-8aa3-4053-820b-835b80e74464&quot;,&quot;9d387ebe-baea-4aa6-b8ff-7004e6d4d90e&quot;,&quot;c4094725-9e1a-4f13-ab85-56cd44d2d22f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9264,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;b6e212bd-7f14-4c8d-855f-4e6521f55ee6&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:275,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nid = await voting.nextBallotId();\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[1], 1, \&quot;memo\&quot;, {from: votingKey});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b74b277b-0992-496e-8d74-c33d6cc34963&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:113,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(1);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(1);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38c91f75-91d8-485d-b939-56b01046b9bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reject vote should be accepted&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote reject vote should be accepted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:113,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-1);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(2);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;574da146-c72f-4bf3-8247-02a6b569e016&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:581,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[3], accounts[1]).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\n// add new voter\nawait keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[4], accounts[2]).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: accounts[4]}).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-2);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(2);\nawait keysManager.addMiningKey(accounts[3]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[5], accounts[3]).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[5]}).should.be.fulfilled;\nprogress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-1);\ntotalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f62fe4f-c127-4a3a-80e7-0899163c369a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote nonVoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote nonVoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9f856c9-9987-4ce6-8c69-2df8af375a81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote before startTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:76,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c90c2242-b754-4abc-a367-64fa09f31133&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote after endTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:109,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0e683c6-dced-44c7-99d2-fd02c1f81455&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:159,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c2a40b3-c162-40f1-ad0d-73123e54d91d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:143,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, 0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 3, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5b7deacd-fea7-4ad8-9139-cca29d36b0e2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:128,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(99, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b1a888ed-7645-4dc4-b29c-54c2500b0e04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;38c91f75-91d8-485d-b939-56b01046b9bb&quot;,&quot;574da146-c72f-4bf3-8247-02a6b569e016&quot;,&quot;2f62fe4f-c127-4a3a-80e7-0899163c369a&quot;,&quot;d9f856c9-9987-4ce6-8c69-2df8af375a81&quot;,&quot;c90c2242-b754-4abc-a367-64fa09f31133&quot;,&quot;e0e683c6-dced-44c7-99d2-fd02c1f81455&quot;,&quot;4c2a40b3-c162-40f1-ad0d-73123e54d91d&quot;,&quot;5b7deacd-fea7-4ad8-9139-cca29d36b0e2&quot;,&quot;b1a888ed-7645-4dc4-b29c-54c2500b0e04&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1470,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e232adba-4520-4b03-8800-db7a668bc559&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:344,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey2, accounts[2]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[4]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey3, accounts[4]).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aaf73abc-5a25-467d-861b-4448f1901904&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path - no action since it didnot meet minimum number of totalVoters&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize happy path - no action since it didnot meet minimum number of totalVoters&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:515,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Ballot to Add Payout Key for miner account[1]\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, payoutKeyToAdd, 3, accounts[1], 1, \&quot;memo\&quot;,{from: votingKey});\nlet activeBallotsLength = await voting.activeBallotsLength();\nvotingId = await voting.activeBallots(activeBallotsLength.toNumber() - 1);\n// console.log(votingId);\nawait voting.finalize(votingId, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.finalize(votingId).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nactiveBallotsLength = await voting.activeBallotsLength();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst votingState = await voting.votingState(votingId);\n\nvotingState.should.be.deep.equal(\n  [\n    new web3.BigNumber(VOTING_START_DATE), //uint256 startTime;\n    new web3.BigNumber(VOTING_END_DATE), //uint256 endTime\n    payoutKeyToAdd, //address affectedKey\n    new web3.BigNumber(3), //uint256 affectedKeyType\n    accounts[1],            //address miningKey\n    new web3.BigNumber(1),  //uint256 totalVoters\n    new web3.BigNumber(-1), //int progress\n    true,                   //bool isFinalized\n    new web3.BigNumber(3),  //uint8 quorumState\n    new web3.BigNumber(1),  //uint256 ballotType\n    new web3.BigNumber(0),  //uint256 index\n    new web3.BigNumber(3),   //uint256 minThresholdOfVoters\n    miningKeyForVotingKey,   // miningKeyCreator\n    \&quot;memo\&quot;\n  ]\n)\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted(votingId, votingKey)\n);\nconst keysState = await keysManager.validatorKeys(accounts[1]);\nkeysState.should.be.deep.equal(\n  [ votingKey,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fad0d7de-4954-4d4f-8ae8-ce6783039df2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize addition of payout key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize addition of payout key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:587,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Ballot to Add Payout Key for miner account[1]\nawait deployAndTestBallot({\n  _affectedKey: payoutKeyToAdd,\n  _affectedKeyType: 3,\n  _miningKey: accounts[1],\n  _ballotType: 1,\n  \n})\nconst keysState = await keysManager.validatorKeys(accounts[1]);\nkeysState.should.be.deep.equal(\n  [ votingKey,\n  payoutKeyToAdd,\n  true,\n  true,\n  true ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bdc17ccd-7ab6-4e59-8c96-c62a220b6143&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize addition of VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize addition of VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:691,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\nlet votingKeyToAdd = accounts[5];\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: votingKeyToAdd,\n  _affectedKeyType: 2,\n  _miningKey: miningKey,\n  _ballotType: 1,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ votingKeyToAdd,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;be4e36da-0894-4571-b8b2-a5546d44cd74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot create ballot for using previous mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize cannot create ballot for using previous mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1451,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(voting.address);\nlet miningKey = accounts[6];\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: miningKey,\n  _affectedKeyType: 1,\n  _miningKey: &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  _ballotType: 1,\n  \n})\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\ntrue.should.be.equal(await poaNetworkConsensusMock.isValidator(miningKey));\nlet validators = await poaNetworkConsensusMock.getValidators();\nawait voting.setTime(VOTING_START_DATE - 1);\nawait deployAndTestBallot({\n  _affectedKey: accounts[5],\n  _affectedKeyType: 1,\n  _miningKey: miningKey,\n  _ballotType: 3,\n  \n})\nawait voting.setTime(VOTING_START_DATE - 1);\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, miningKey, 1, accounts[5], 3, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;310ecf55-8809-4efe-902d-910def026bdf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize addition of MiningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize addition of MiningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:755,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(voting.address);\nlet miningKey = accounts[6];\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: miningKey,\n  _affectedKeyType: 1,\n  _miningKey: &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  _ballotType: 1,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators();\nvalidators.should.contain(miningKey);\ntrue.should.be.equal(await poaNetworkConsensusMock.isValidator(miningKey));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e82f539-a04a-432c-8894-3fb5e17db35d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize removal of MiningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize removal of MiningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:860,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: miningKey,\n  _affectedKeyType: 1,\n  _miningKey: miningKey,\n  _ballotType: 2,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators();\nvalidators.should.not.contain(miningKey);\nfalse.should.be.equal(await poaNetworkConsensusMock.isValidator(miningKey));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;24d3af89-941e-4069-a3b5-f581df0181d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize removal of VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize removal of VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:721,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet votingKeyToAdd = accounts[5];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKeyToAdd, miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: votingKeyToAdd,\n  _affectedKeyType: 2,\n  _miningKey: miningKey,\n  _ballotType: 2,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a8731da4-b1f3-4008-ac6c-132f83331b22&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize removal of PayoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize removal of PayoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:747,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait keysManager.addPayoutKey(affectedKey, miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: affectedKey,\n  _affectedKeyType: 3,\n  _miningKey: miningKey,\n  _ballotType: 2,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;569555d4-ce74-4aaf-b74e-ee3e377bc5ab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize swap of VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize swap of VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:716,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait keysManager.addVotingKey(affectedKey, miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nlet newVotingKey = accounts[2];\nawait deployAndTestBallot({\n  _affectedKey: newVotingKey,\n  _affectedKeyType: 2,\n  _miningKey: miningKey,\n  _ballotType: 3,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ newVotingKey,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;68969fce-8654-431d-bcf8-f50959dd5505&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize swap of PayoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize swap of PayoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:715,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait keysManager.addPayoutKey(affectedKey, miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nlet newPayoutKey = accounts[2];\nawait deployAndTestBallot({\n  _affectedKey: newPayoutKey,\n  _affectedKeyType: 3,\n  _miningKey: miningKey,\n  _ballotType: 3,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  newPayoutKey,\n  true,\n  false,\n  true ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;09ff3be9-c0da-40b5-9d2b-c85e77366f89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize swap of MiningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize swap of MiningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:929,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: affectedKey,\n  _affectedKeyType: 1,\n  _miningKey: miningKey,\n  _ballotType: 3,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nconst keysStateNew = await keysManager.validatorKeys(affectedKey);\nkeysStateNew.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators();\nvalidators.should.not.contain(miningKey);\nvalidators.should.contain(affectedKey);\nfalse.should.be.equal(await poaNetworkConsensusMock.isValidator(miningKey));\ntrue.should.be.equal(await poaNetworkConsensusMock.isValidator(affectedKey));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2063a94e-245b-4bb6-b273-a8f979ecd29d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevent double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize prevent double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1139,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, affectedKey, 1, miningKey, 3, \&quot;memo\&quot;,{from: votingKey});\nawait voting.createVotingForKeys(VOTING_START_DATE+2, VOTING_END_DATE+2, affectedKey, 1, miningKey, 2, \&quot;memo\&quot;,{from: votingKey});\nconst activeBallotsLength = await voting.activeBallotsLength();\nvotingId = await voting.activeBallots(activeBallotsLength.toNumber() - 2);\nlet votingIdForSecond = votingId.add(1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal(await voting.hasAlreadyVoted(votingId, votingKey2));\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nfalse.should.be.equal(await voting.getIsFinalized(votingId));\nawait voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\nnew web3.BigNumber(3).should.be.bignumber.equal(await voting.getBallotType(votingId));\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\nawait voting.finalize(votingId, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(2).should.be.bignumber.equal(await voting.getBallotType(votingIdForSecond));\nfalse.should.be.equal(await voting.getIsFinalized(votingIdForSecond));\nawait voting.vote(votingIdForSecond, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 3);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.fulfilled;\nnew web3.BigNumber(-1).should.be.bignumber.equal(await voting.getProgress(votingIdForSecond))\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getProgress(votingId))&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0ec3b108-868f-4a94-8060-76b1001505c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fad0d7de-4954-4d4f-8ae8-ce6783039df2&quot;,&quot;bdc17ccd-7ab6-4e59-8c96-c62a220b6143&quot;,&quot;be4e36da-0894-4571-b8b2-a5546d44cd74&quot;,&quot;310ecf55-8809-4efe-902d-910def026bdf&quot;,&quot;3e82f539-a04a-432c-8894-3fb5e17db35d&quot;,&quot;24d3af89-941e-4069-a3b5-f581df0181d0&quot;,&quot;a8731da4-b1f3-4008-ac6c-132f83331b22&quot;,&quot;569555d4-ce74-4aaf-b74e-ee3e377bc5ab&quot;,&quot;68969fce-8654-431d-bcf8-f50959dd5505&quot;,&quot;09ff3be9-c0da-40b5-9d2b-c85e77366f89&quot;,&quot;2063a94e-245b-4bb6-b273-a8f979ecd29d&quot;,&quot;0ec3b108-868f-4a94-8060-76b1001505c5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9826,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;04ed6536-5210-43be-a3b0-1cb8883de300&quot;,&quot;title&quot;:&quot;Contract: VotingToChangeMinThreshold [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1574,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d87b8a2-9e6f-4931-ba23-ed69dcb88450&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72d5d6b9-2aa9-456d-92ee-fa001d84ec95&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:878,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\nproxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensusMock.address);\nkeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\nballotsStorage = await BallotsStorage.new(proxyStorageMock.address);\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nvoting = await Voting.new(proxyStorageMock.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  masterOfCeremony,\n  voting.address,\n  masterOfCeremony,\n  ballotsStorage.address,\n  masterOfCeremony\n);\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey2, accounts[2]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[4]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey3, accounts[4]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[5]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[6]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[7]).should.be.fulfilled;\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ab182a8-e224-4cfa-8c0d-3b83a1c2cade&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49f8cf13-8f9f-48be-8d87-b177df2c5fc0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;94e5c366-fb66-44a6-b4b3-199941bb45af&quot;,&quot;title&quot;:&quot;#createBallotToChangeThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallotToChangeThreshold \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;83939bf6-9492-4037-be9d-af576c85cd60&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallotToChangeThreshold happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;,{from: votingKey});\nconst startTime = await voting.getStartTime(id.toNumber());\nconst endTime = await voting.getEndTime(id.toNumber());\nconst keysManagerFromContract = await voting.getKeysManager();\nlet votingState = await voting.votingState(id);\nvotingState.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE),\n  new web3.BigNumber(VOTING_END_DATE),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  false,\n  new web3.BigNumber(1),\n  new web3.BigNumber(0),\n  new web3.BigNumber(3),\n  new web3.BigNumber(4),\n  miningKeyForVotingKey,\n  \&quot;memo\&quot;\n])\nstartTime.should.be.bignumber.equal(VOTING_START_DATE);\nendTime.should.be.bignumber.equal(VOTING_END_DATE);\nkeysManagerFromContract.should.be.equal(keysManager.address);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;011d78b3-04b6-42fa-ba15-54e69130ca23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;proposed value should be more than or equal to 3&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallotToChangeThreshold proposed value should be more than or equal to 3&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 2,\&quot;memo\&quot;, {from: votingKey}).should.be.fulfilled.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62994723-7573-4304-b7bc-eebf9d286ce3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;proposed value should not be equal to the same value&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallotToChangeThreshold proposed value should not be equal to the same value&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 3,\&quot;memo\&quot;, {from: votingKey}).should.be.fulfilled.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;604ea9fe-3cab-4051-af17-2fdb60c17386&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create more ballots than the limit&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallotToChangeThreshold should not let create more ballots than the limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8904,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nconst VOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 4,\&quot;memo\&quot;, {from: votingKey});\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 4,\&quot;memo\&quot;, {from: votingKey});\n// we have 6 validators, so 200 limit / 6 = 33.3 ~ 33\nnew web3.BigNumber(33).should.be.bignumber.equal(await voting.getBallotLimitPerValidator());\nawait addValidators({proxyStorageMock, keysManager, poaNetworkConsensusMock}); // add 100 validators, so total will be 106 validators\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getBallotLimitPerValidator());\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0596687-4d93-4f9f-9a22-173f23eb4655&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;011d78b3-04b6-42fa-ba15-54e69130ca23&quot;,&quot;62994723-7573-4304-b7bc-eebf9d286ce3&quot;,&quot;604ea9fe-3cab-4051-af17-2fdb60c17386&quot;,&quot;f0596687-4d93-4f9f-9a22-173f23eb4655&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9132,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;35c50321-8b37-467c-b3ea-89591a1987e0&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:135,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId();\nlet validators = await poaNetworkConsensusMock.getValidators();\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;,{from: votingKey});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5b4b304e-65a2-4062-8555-b0e92a16706a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:120,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(1);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(1);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0fa4f2c0-65aa-4265-a679-749f097104b2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reject vote should be accepted&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote reject vote should be accepted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:122,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-1);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(2);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c400329a-318e-4fd3-a00d-2c8088fad4c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:277,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\n// add new voter\nawait voting.vote(id, choice.reject, {from: votingKey2}).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-2);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(2);\nawait voting.vote(id, choice.accept, {from: votingKey3}).should.be.fulfilled;\nprogress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-1);\ntotalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c850c97f-27ad-4e68-bfa9-4cf3b6cc3c7d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote nonVoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote nonVoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;594623c2-140a-41af-843b-3d5fcf045a83&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote before startTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b1ecb00-d568-4f8d-80f6-c49e522910f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote after endTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4aafc349-e60a-4650-85fd-806d8794f53b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:150,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0b8393d-13ca-4833-8a2c-e4c12b75d610&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:179,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, 0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 3, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46586e1f-92f5-4816-bbe2-d7db88ca463d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:150,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(99, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a06659c-69d2-4392-aa94-bdcd210ed297&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0fa4f2c0-65aa-4265-a679-749f097104b2&quot;,&quot;c400329a-318e-4fd3-a00d-2c8088fad4c1&quot;,&quot;c850c97f-27ad-4e68-bfa9-4cf3b6cc3c7d&quot;,&quot;594623c2-140a-41af-843b-3d5fcf045a83&quot;,&quot;0b1ecb00-d568-4f8d-80f6-c49e522910f1&quot;,&quot;4aafc349-e60a-4650-85fd-806d8794f53b&quot;,&quot;e0b8393d-13ca-4833-8a2c-e4c12b75d610&quot;,&quot;46586e1f-92f5-4816-bbe2-d7db88ca463d&quot;,&quot;1a06659c-69d2-4392-aa94-bdcd210ed297&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1210,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;1e83fb98-6426-4082-89e9-727f61404b1d&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;39fdbdaa-aaaf-4452-bf03-2a54a1b954c6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;doesnot change if it did not pass minimum threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize doesnot change if it did not pass minimum threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:356,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue = 4;\nvotingId = await voting.nextBallotId();\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, proposedValue, \&quot;memo\&quot;,{from: votingKey});\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.fulfilled;\n// await voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\nactiveBallotsLength = await voting.activeBallotsLength();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst votingState = await voting.votingState(votingId);\n\nvotingState.should.be.deep.equal(\n  [\n    new web3.BigNumber(VOTING_START_DATE), //uint256 startTime;\n    new web3.BigNumber(VOTING_END_DATE), //uint256 endTime\n    new web3.BigNumber(1),  //uint256 totalVoters\n    new web3.BigNumber(1), //int progress\n    true,                   //bool isFinalized\n    new web3.BigNumber(3),  //uint8 quorumState\n    new web3.BigNumber(0),  //uint256 index\n    new web3.BigNumber(3),   //uint256 minThresholdOfVoters\n    new web3.BigNumber(proposedValue), // uint256 proposedValue\n    miningKeyForVotingKey,  // creator\n    \&quot;memo\&quot;\n  ]\n)\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted(votingId, votingKey)\n);\nconst minThresholdOfVoters = await ballotsStorage.getBallotThreshold(1);\nminThresholdOfVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fb855085-55b9-41e5-9ece-b0e5670fb7f0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change to proposedValue when quorum is reached&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize should change to proposedValue when quorum is reached&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:782,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue = 4;\nvotingId = await voting.nextBallotId();\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, proposedValue, \&quot;memo\&quot;,{from: votingKey});\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.reject, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\nactiveBallotsLength = await voting.activeBallotsLength();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst votingState = await voting.votingState(votingId);\nvotingState.should.be.deep.equal(\n  [\n    new web3.BigNumber(VOTING_START_DATE), //uint256 startTime;\n    new web3.BigNumber(VOTING_END_DATE), //uint256 endTime\n    new web3.BigNumber(3),  //uint256 totalVoters\n    new web3.BigNumber(1), //int progress\n    true,                   //bool isFinalized\n    new web3.BigNumber(2),  //uint8 quorumState\n    new web3.BigNumber(0),  //uint256 index\n    new web3.BigNumber(3),   //uint256 minThresholdOfVoters\n    new web3.BigNumber(proposedValue), // uint256 proposedValue\n    miningKeyForVotingKey,  //creator\n    \&quot;memo\&quot;\n  ]\n)\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted(votingId, votingKey)\n);\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted(votingId, votingKey2)\n);\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted(votingId, votingKey3)\n);\nconst minThresholdOfVoters = await ballotsStorage.getBallotThreshold(1);\nminThresholdOfVoters.should.be.bignumber.equal(proposedValue);\nlet votingForKeys = await VotingForKeys.new(proxyStorageMock.address);\n\nlet nextId = await votingForKeys.nextBallotId();\nawait votingForKeys.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[5], 3, accounts[1], 1, \&quot;memo\&quot;, {from: votingKey});\nconst minThresholdVotingForKeys = await votingForKeys.getMinThresholdOfVoters(nextId);\nminThresholdVotingForKeys.should.be.bignumber.equal(proposedValue);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eb770ae9-5a52-4472-b3b9-99a7a6169b65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize prevents double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1157,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue1 = 4;\nlet proposedValue2 = 5;\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, proposedValue1, \&quot;memo\&quot;,{from: votingKey});\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(\&quot;0xa6Bf70bd230867c870eF13631D7EFf1AE8Ab85c9\&quot;).should.be.fulfilled;\nawait keysManager.addMiningKey(\&quot;0xa6Bf70bd230867c870eF13631D7EFf1AE8Ab85d9\&quot;).should.be.fulfilled;\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE+2, VOTING_END_DATE+2, proposedValue2, \&quot;memo\&quot;,{from: votingKey});\nawait voting.finalize(votingId, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nconst activeBallotsLength = await voting.activeBallotsLength();\nvotingId = await voting.activeBallots(activeBallotsLength.toNumber() - 2);\nlet votingIdForSecond = votingId.add(1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal(await voting.hasAlreadyVoted(votingId, votingKey2));\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nfalse.should.be.equal(await voting.getIsFinalized(votingId));\nawait voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(4).should.be.bignumber.equal(await voting.getProposedValue(votingId));\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\nawait voting.finalize(votingId, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(5).should.be.bignumber.equal(await voting.getProposedValue(votingIdForSecond));\nfalse.should.be.equal(await voting.getIsFinalized(votingIdForSecond));\nawait voting.vote(votingIdForSecond, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 3);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.fulfilled;\nnew web3.BigNumber(-1).should.be.bignumber.equal(await voting.getProgress(votingIdForSecond))\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getProgress(votingId))&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c5b798b-c2a8-4d55-9f57-a410504c5dfa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fb855085-55b9-41e5-9ece-b0e5670fb7f0&quot;,&quot;eb770ae9-5a52-4472-b3b9-99a7a6169b65&quot;,&quot;7c5b798b-c2a8-4d55-9f57-a410504c5dfa&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2295,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e4a2fdfa-5793-4ada-9e26-2c54cc8fbf66&quot;,&quot;title&quot;:&quot;Contract: VotingToChangeProxyAddress [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1337,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d14eae1-ade0-4727-988f-a292df035387&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ab6ab70-0117-4b5b-bd3d-1a569fdd8ed5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:348,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\nproxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensusMock.address);\nkeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\nballotsStorage = await BallotsStorage.new(proxyStorageMock.address);\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nvoting = await VotingToChangeProxyAddress.new(proxyStorageMock.address);\nvalidatorMetadata = await ValidatorMetadata.new();\nvalidatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, validatorMetadata.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  masterOfCeremony,\n  masterOfCeremony,\n  voting.address,\n  ballotsStorage.address,\n  validatorMetadataEternalStorage.address\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6191713-347c-47d2-96b3-61cdb20ae48c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17fa53ba-123a-403b-bd46-981d1d0eb3f0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;900a054d-94bb-45e1-8921-7241a2766c41&quot;,&quot;title&quot;:&quot;#createBallotToChangeProxyAddress&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallotToChangeProxyAddress \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:99,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bede58db-2f70-4364-aa7c-33dccbf795d6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallotToChangeProxyAddress happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:184,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// uint256 _startTime,\n// uint256 _endTime,\n// address _proposedValue,\n// uint8 _contractType\nconst {logs} = await voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], 1, \&quot;memo\&quot;, { from: votingKey }\n);\nconst startTime = await voting.getStartTime(id.toNumber());\nconst endTime = await voting.getEndTime(id.toNumber());\nconst keysManagerFromContract = await voting.getKeysManager();\nlet votingState = await voting.votingState(id);\nvotingState.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE),\n  new web3.BigNumber(VOTING_END_DATE),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  false,\n  new web3.BigNumber(1),\n  new web3.BigNumber(0),\n  new web3.BigNumber(1),\n  accounts[5],\n  new web3.BigNumber(1),\n  miningKeyForVotingKey,\n  \&quot;memo\&quot;        \n])\nlet activeBallotsLength = await voting.activeBallotsLength();\nactiveBallotsLength.should.be.bignumber.equal(1);\nlet nextBallotId = await voting.nextBallotId();\nnextBallotId.should.be.bignumber.equal(1);\nstartTime.should.be.bignumber.equal(VOTING_START_DATE);\nendTime.should.be.bignumber.equal(VOTING_END_DATE);\nkeysManagerFromContract.should.be.equal(keysManager.address);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f123be1-8c66-4a71-b6a9-ae5d8ff973bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;proposed address should not be 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallotToChangeProxyAddress proposed address should not be 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallotToChangeProxyAddress(VOTING_START_DATE, VOTING_END_DATE, &#x27;0x0000000000000000000000000000000000000000&#x27;, 2, \&quot;memo\&quot;,{ from: votingKey }).should.be.fulfilled.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8f1ee9de-49bd-4e24-8ff9-a8d0c503335c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;can creates multiple ballots&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallotToChangeProxyAddress can creates multiple ballots&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:275,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { logs } = await voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], 1, \&quot;memo\&quot;,{ from: votingKey });\nconst startTime = await voting.getStartTime(id.toNumber());\nconst endTime = await voting.getEndTime(id.toNumber());\nconst keysManagerFromContract = await voting.getKeysManager();\nlet activeBallotsLength = await voting.activeBallotsLength();\nactiveBallotsLength.should.be.bignumber.equal(1);\nlet nextBallotId = await voting.nextBallotId();\nnextBallotId.should.be.bignumber.equal(1);\nawait voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE + 1, VOTING_END_DATE + 1, accounts[5], 2, \&quot;memo\&quot;,{ from: votingKey }\n);\nlet votingState = await voting.votingState(nextBallotId);\nvotingState.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE+1),\n  new web3.BigNumber(VOTING_END_DATE+1),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  false,\n  new web3.BigNumber(1),\n  new web3.BigNumber(1),\n  new web3.BigNumber(1),\n  accounts[5],\n  new web3.BigNumber(2),\n  miningKeyForVotingKey,\n  \&quot;memo\&quot;\n])&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6620da17-9c54-4528-b14e-7673e2249bbd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create more ballots than the limit&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallotToChangeProxyAddress should not let create more ballots than the limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8822,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nconst VOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallotToChangeProxyAddress(VOTING_START_DATE, VOTING_END_DATE, accounts[5], 2, \&quot;memo\&quot;,{from: votingKey});\nawait voting.createBallotToChangeProxyAddress(VOTING_START_DATE, VOTING_END_DATE, accounts[5], 2, \&quot;memo\&quot;,{from: votingKey});\n// we have 1 validator, so 200 limit / 1 = 200\nnew web3.BigNumber(200).should.be.bignumber.equal(await voting.getBallotLimitPerValidator());\nawait addValidators({proxyStorageMock, keysManager, poaNetworkConsensusMock}); // add 100 validators, so total will be 101 validator\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getBallotLimitPerValidator());\nawait voting.createBallotToChangeProxyAddress(VOTING_START_DATE, VOTING_END_DATE, accounts[5], 2, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b14faca-cead-47ab-b537-0e182d7bf00c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9f123be1-8c66-4a71-b6a9-ae5d8ff973bc&quot;,&quot;8f1ee9de-49bd-4e24-8ff9-a8d0c503335c&quot;,&quot;6620da17-9c54-4528-b14e-7673e2249bbd&quot;,&quot;0b14faca-cead-47ab-b537-0e182d7bf00c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9305,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;4dd52691-4245-479d-9931-e6c9091bdc4a&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:221,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nid = await voting.nextBallotId();\nawait voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], 1, \&quot;memo\&quot;, { from: votingKey }\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5eb0fe35-df0e-4036-bddf-2b5777ab1377&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:117,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst { logs } = await voting.vote(id, choice.accept, { from: votingKey }).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(1);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(1);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ccbe956-56ff-42b8-ad7e-8d6ac49c4e0a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reject vote should be accepted&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote reject vote should be accepted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:104,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst { logs } = await voting.vote(id, choice.reject, { from: votingKey }).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-1);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(2);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9bf49794-8acd-471c-b13a-4d62b9559a49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:578,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[3], accounts[1]).should.be.fulfilled;\nawait voting.vote(id, choice.reject, { from: accounts[3] }).should.be.rejectedWith(ERROR_MSG);\n// add new voter\nawait keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[4], accounts[2]).should.be.fulfilled;\nawait voting.vote(id, choice.reject, { from: accounts[4] }).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-2);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(2);\nawait keysManager.addMiningKey(accounts[3]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[5], accounts[3]).should.be.fulfilled;\nawait voting.vote(id, choice.accept, { from: accounts[5] }).should.be.fulfilled;\nprogress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-1);\ntotalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a9ad35c-fa37-4814-af77-acaba6d586d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote nonVoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote nonVoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:134,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, { from: accounts[0] }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9658809-7de1-4254-b8a9-1c4472e45338&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote before startTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:81,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ccb26d4-e0e9-4e76-9941-ce165909a6e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote after endTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:84,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77d45025-c785-44a8-829d-fa99220336a3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:194,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.fulfilled;\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bcc3b3eb-705a-43a6-af8d-c26bdd5eeead&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:130,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, 0, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 3, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;088cc22e-f1bc-417b-96c0-3806a49074bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:130,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(99, 1, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, 1, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;666bc442-49da-4fa6-85e2-9fc375a3e7c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3ccbe956-56ff-42b8-ad7e-8d6ac49c4e0a&quot;,&quot;9bf49794-8acd-471c-b13a-4d62b9559a49&quot;,&quot;8a9ad35c-fa37-4814-af77-acaba6d586d1&quot;,&quot;d9658809-7de1-4254-b8a9-1c4472e45338&quot;,&quot;7ccb26d4-e0e9-4e76-9941-ce165909a6e1&quot;,&quot;77d45025-c785-44a8-829d-fa99220336a3&quot;,&quot;bcc3b3eb-705a-43a6-af8d-c26bdd5eeead&quot;,&quot;088cc22e-f1bc-417b-96c0-3806a49074bb&quot;,&quot;666bc442-49da-4fa6-85e2-9fc375a3e7c0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1552,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;02f100a4-1048-48b3-bea1-0f823b36ffab&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:372,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[6]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey2, accounts[6]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[4]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey3, accounts[4]).should.be.fulfilled;\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41fbbbc7-7348-4b41-bc79-ad5f342122d9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;doesnot change if it did not pass minimum threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize doesnot change if it did not pass minimum threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:403,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue = 5;\nlet contractType = 1; //keysManager\nvotingId = await voting.nextBallotId();\nawait voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], contractType, \&quot;memo\&quot;, { from: votingKey }\n);\nawait voting.finalize(votingId, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.fulfilled;\n// await voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nconst { logs } = await voting.finalize(votingId, { from: votingKey }).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nactiveBallotsLength = await voting.activeBallotsLength();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst votingState = await voting.votingState(votingId);\nvotingState.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE),\n  new web3.BigNumber(VOTING_END_DATE),\n  new web3.BigNumber(1), //totalVoters\n  new web3.BigNumber(1), //progress\n  true, //isFinalized\n  new web3.BigNumber(3), //quorumState enum QuorumStates {Invalid, InProgress, Accepted, Rejected}\n  new web3.BigNumber(0), //index\n  new web3.BigNumber(2), //minThreshold\n  accounts[5], //porposedValue\n  new web3.BigNumber(contractType),\n  miningKeyForVotingKey, //creator\n  \&quot;memo\&quot;\n])\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted(votingId, votingKey)\n);\nconst minThresholdOfVoters = await ballotsStorage.getBallotThreshold(1);\nminThresholdOfVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;817b5cb7-f8ec-47c0-8e84-a947bfcf8baa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change getKeysManager address&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change getKeysManager address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:533,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 1;\nlet newAddress = accounts[5];\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageMock.getKeysManager());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6a156134-b219-498f-88c0-f855899ba5ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change getVotingToChangeKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change getVotingToChangeKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:643,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 2;\nlet newAddress = accounts[5];\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageMock.getVotingToChangeKeys());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b0a1ddc-3eae-4e90-b538-6cd347673662&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change getVotingToChangeMinThreshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change getVotingToChangeMinThreshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:658,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 3;\nlet newAddress = accounts[5];\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageMock.getVotingToChangeMinThreshold());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;42e9e4d5-e71b-424a-98b5-1cf1bd61369c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change getVotingToChangeProxy&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change getVotingToChangeProxy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:646,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 4;\nlet newAddress = accounts[5];\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageMock.getVotingToChangeProxy());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd7f4eaa-13c3-48a4-8ae3-1efd7d84c470&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change getBallotsStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change getBallotsStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:677,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 5;\nlet newAddress = accounts[5];\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageMock.getBallotsStorage());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ecf4d29c-7b78-408a-b0b0-d84564d90aae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change ValidatorMetadata implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change ValidatorMetadata implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:696,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 7;\nlet validatorMetadataNew = await ValidatorMetadata.new();\nlet newAddress = validatorMetadataNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getValidatorMetadata();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c8b346b4-d5b3-47be-b0ff-0fad680b0f9c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change ValidatorMetadata storage&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change ValidatorMetadata storage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:691,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 8;\nlet validatorMetadataEternalStorageNew = await EternalStorageProxy.new(proxyStorageMock.address, validatorMetadata.address);\nlet newAddress = validatorMetadataEternalStorageNew.address;\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageMock.getValidatorMetadata());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e6a4a29c-513c-4950-9f95-4de892027178&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize prevents double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:988,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newAddress1 = accounts[4];\nlet newAddress2 = accounts[5];\nlet contractType1 = 4;\nlet contractType2 = 5;\nawait voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE, VOTING_END_DATE, newAddress1, contractType1, \&quot;memo\&quot;, { from: votingKey }\n);\nawait voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE+2, VOTING_END_DATE+2, newAddress2, contractType2, \&quot;memo\&quot;, { from: votingKey }\n);\n  \nconst activeBallotsLength = await voting.activeBallotsLength();\nvotingId = await voting.activeBallots(activeBallotsLength.toNumber() - 2);\nlet votingIdForSecond = votingId.add(1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal(await voting.hasAlreadyVoted(votingId, votingKey2));\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nfalse.should.be.equal(await voting.getIsFinalized(votingId));\nawait voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\nawait voting.finalize(votingId, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal(await voting.getIsFinalized(votingIdForSecond));\nawait voting.vote(votingIdForSecond, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 3);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.fulfilled;\nnew web3.BigNumber(-1).should.be.bignumber.equal(await voting.getProgress(votingIdForSecond))\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getProgress(votingId))\nlet votingState1 = await voting.votingState(votingId);\nvotingState1.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE),\n  new web3.BigNumber(VOTING_END_DATE),\n  new web3.BigNumber(3), //totalVoters\n  new web3.BigNumber(1), //progress\n  true, //isFinalized\n  new web3.BigNumber(2), //quorumState enum QuorumStates {Invalid, InProgress, Accepted, Rejected}\n  new web3.BigNumber(0), //index\n  new web3.BigNumber(2), //minThreshold\n  newAddress1, //proposedValue\n  new web3.BigNumber(contractType1),\n  miningKeyForVotingKey, //creator\n  \&quot;memo\&quot;\n])\nlet votingState2 = await voting.votingState(votingIdForSecond);\nvotingState2.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE+2),\n  new web3.BigNumber(VOTING_END_DATE+2),\n  new web3.BigNumber(1), //totalVoters\n  new web3.BigNumber(-1), //progress\n  true, //isFinalized\n  new web3.BigNumber(3), //quorumState enum QuorumStates {Invalid, InProgress, Accepted, Rejected}\n  new web3.BigNumber(0), //index\n  new web3.BigNumber(2), //minThreshold\n  newAddress2, //proposedValue\n  new web3.BigNumber(contractType2),\n  miningKeyForVotingKey, //creator\n  \&quot;memo\&quot;\n])&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da265aff-a327-4e2c-b467-20cd7d5f5530&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;817b5cb7-f8ec-47c0-8e84-a947bfcf8baa&quot;,&quot;6a156134-b219-498f-88c0-f855899ba5ea&quot;,&quot;6b0a1ddc-3eae-4e90-b538-6cd347673662&quot;,&quot;42e9e4d5-e71b-424a-98b5-1cf1bd61369c&quot;,&quot;dd7f4eaa-13c3-48a4-8ae3-1efd7d84c470&quot;,&quot;ecf4d29c-7b78-408a-b0b0-d84564d90aae&quot;,&quot;c8b346b4-d5b3-47be-b0ff-0fad680b0f9c&quot;,&quot;e6a4a29c-513c-4950-9f95-4de892027178&quot;,&quot;da265aff-a327-4e2c-b467-20cd7d5f5530&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5935,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000},&quot;copyrightYear&quot;:2018}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;poa-network-consensus-contracts&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;charts&quot;:true,&quot;enableCharts&quot;:true,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;jsonFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/mochawesome-report/mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/mochawesome-report/mochawesome.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>